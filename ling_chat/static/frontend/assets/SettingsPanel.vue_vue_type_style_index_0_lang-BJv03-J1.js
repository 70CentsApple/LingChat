import{d as j,p as re,q as Q,r as m,s as J,v as U,c as g,j as N,b as t,n as te,h as v,x as le,_ as L,o as Z,y as fe,F as O,m as Y,t as S,i as W,e as H,z as B,k as o,A as Ce,B as _e,C as G,D as se,E as de,G as ye,f as p,H as D,I as ke,J as pe,K as $e,L as Se,M as me,N as X,w as h,O as ee,P as ge,Q as xe,T as Ae,l as ve,R as ne}from"./index-YHkCiyYM.js";import{S as Be,_ as Ie}from"./StarField-CtJy7d52.js";const be="/api/v1",F={AVATAR:{BASE:`${be}/chat/character/get_avatar`},VOICE:{BASE:`${be}/chat/sound/get_voice`}},Me={åŽŒæ¶:"åŽŒæ¶",é«˜å…´:"é«˜å…´",æ‹…å¿ƒ:"æ‹…å¿ƒ",ç”Ÿæ°”:"ç”Ÿæ°”",ç´§å¼ :"ç´§å¼ ",å®³æ€•:"å®³æ€•",å®³ç¾ž:"å®³ç¾ž",æ…Œå¼ :"æ…Œå¼ ",è®¤çœŸ:"è®¤çœŸ",æ— å¥ˆ:"æ— å¥ˆ",å…´å¥‹:"å…´å¥‹",ç–‘æƒ‘:"ç–‘æƒ‘",å“­æ³£:"ä¼¤å¿ƒ",å¿ƒåŠ¨:"å¿ƒåŠ¨",è°ƒçš®:"è°ƒçš®",éš¾ä¸ºæƒ…:"ç¾žè€»",è‡ªä¿¡:"è‡ªä¿¡",æƒŠè®¶:"æƒŠè®¶",æ­£å¸¸:"æ­£å¸¸",AIæ€è€ƒ:"none"},he={åŽŒæ¶:{animation:"none",bubbleImage:"../pictures/animation/ç”Ÿæ°”.webp",bubbleClass:"angry",audio:"../audio_effects/åŽŒæ¶.wav",avatar:`${F.AVATAR.BASE}/åŽŒæ¶.png`},é«˜å…´:{animation:"happy-bounce",bubbleImage:"../pictures/animation/é«˜å…´.webp",bubbleClass:"happy",audio:"../audio_effects/å–œæ‚¦.wav",avatar:`${F.AVATAR.BASE}/é«˜å…´.png`},æ‹…å¿ƒ:{animation:"none",bubbleImage:"../pictures/animation/æµæ³ª.webp",bubbleClass:"none",audio:"../audio_effects/ä¼¤å¿ƒ.wav",avatar:`${F.AVATAR.BASE}/æ‹…å¿ƒ.png`},ç”Ÿæ°”:{animation:"angry-jump",bubbleImage:"../pictures/animation/ç”Ÿæ°”2.webp",bubbleClass:"angry",audio:"../audio_effects/ç”Ÿæ°”.wav",avatar:`${F.AVATAR.BASE}/ç”Ÿæ°”.png`},ç´§å¼ :{animation:"none",bubbleImage:"../pictures/animation/ç´§å¼ .webp",bubbleClass:"none",audio:"../audio_effects/å°´å°¬.wav",avatar:`${F.AVATAR.BASE}/ç´§å¼ .png`},å®³æ€•:{animation:"none",bubbleImage:"../pictures/animation/æƒŠè®¶.webp",bubbleClass:"none",audio:"../audio_effects/éœ‡æƒŠ.wav",avatar:`${F.AVATAR.BASE}/å®³æ€•.png`},å®³ç¾ž:{animation:"none",bubbleImage:"../pictures/animation/å®³ç¾ž.webp",bubbleClass:"shy",audio:"../audio_effects/å®³ç¾ž.wav",avatar:`${F.AVATAR.BASE}/å®³ç¾ž.png`},æ…Œå¼ :{animation:"none",bubbleImage:"../pictures/animation/æ…Œä¹±.webp",bubbleClass:"none",audio:"../audio_effects/éœ‡æƒŠ.wav",avatar:`${F.AVATAR.BASE}/æ…Œå¼ .png`},è®¤çœŸ:{animation:"serious-think",bubbleImage:"none",bubbleClass:"none",audio:"none",avatar:`${F.AVATAR.BASE}/è®¤çœŸ.png`},æ— å¥ˆ:{animation:"none",bubbleImage:"../pictures/animation/å¹æ°”.webp",bubbleClass:"none",audio:"../audio_effects/å¹æ°”.wav",avatar:`${F.AVATAR.BASE}/æ— å¥ˆ.png`},å…´å¥‹:{animation:"happy-bounce",bubbleImage:"../pictures/animation/èŠå¤©.webp",bubbleClass:"none",audio:"../audio_effects/èŠå¤©.wav",avatar:`${F.AVATAR.BASE}/å…´å¥‹.png`},ç–‘æƒ‘:{animation:"none",bubbleImage:"../pictures/animation/ç–‘é—®.webp",bubbleClass:"none",audio:"../audio_effects/ç–‘é—®.wav",avatar:`${F.AVATAR.BASE}/ç–‘æƒ‘.png`},å“­æ³£:{animation:"none",bubbleImage:"../pictures/animation/æµæ³ª.webp",bubbleClass:"none",audio:"../audio_effects/ä¼¤å¿ƒ.wav",avatar:`${F.AVATAR.BASE}/ä¼¤å¿ƒ.png`},å¿ƒåŠ¨:{animation:"heart-beat",bubbleImage:"../pictures/animation/å¿ƒåŠ¨.webp",bubbleClass:"none",audio:"../audio_effects/å–œçˆ±.wav",avatar:`${F.AVATAR.BASE}/å¿ƒåŠ¨.png`},è°ƒçš®:{animation:"naughty-bounce",bubbleImage:"../pictures/animation/é«˜å…´.webp",bubbleClass:"none",audio:"../audio_effects/æ„‰å¿«.wav",avatar:`${F.AVATAR.BASE}/è°ƒçš®.png`},éš¾ä¸ºæƒ…:{animation:"embarrassed-emo",bubbleImage:"../pictures/animation/éš¾ä¸ºæƒ….webp",bubbleClass:"none",audio:"../audio_effects/å¯Ÿè§‰.wav",avatar:`${F.AVATAR.BASE}/ç¾žè€».png`},è‡ªä¿¡:{animation:"none",bubbleImage:"../pictures/animation/é«˜å…´.webp",bubbleClass:"none",audio:"../audio_effects/æ„‰å¿«.wav",avatar:`${F.AVATAR.BASE}/è‡ªä¿¡.png`},æƒŠè®¶:{animation:"none",bubbleImage:"../pictures/animation/æƒŠè®¶.webp",bubbleClass:"none",audio:"../audio_effects/å¯Ÿè§‰.wav",avatar:`${F.AVATAR.BASE}/æƒŠè®¶.png`},æ­£å¸¸:{animation:"none",bubbleImage:"none",bubbleClass:"none",audio:"none",avatar:`${F.AVATAR.BASE}/æ­£å¸¸.png`},AIæ€è€ƒ:{animation:"none",bubbleImage:"../pictures/animation/AIæ€è€ƒ.webp",bubbleClass:"none",audio:"../audio_effects/æ— è¯­.wav",avatar:"none"}},Te=j({__name:"GameAvatar",emits:["audio-ended"],setup(n,{expose:e,emit:u}){const l=re(),a=Q(),s=u,c=m(null),d=m(null),_=m("normalx"),k=m(""),A=m(!1),M=m(""),w=m(""),i=J(()=>{const x=l.character,E=l.avatar.clothes_name??"default",q=l.avatar.emotion,z=he[q]||he.æ­£å¸¸;if(q==="AIæ€è€ƒ")return"none";const f=`${z?.avatar}/${E}`;return l.script.isRunning?`/api/v1/chat/character/get_script_avatar/${x}/${E}/${Me[q]}`:`${z?.avatar?f:""}`}),r=J(()=>({[_.value]:!0,"avatar-visible":l.avatar.show,"avatar-hidden":!l.avatar.show})),b=J(()=>({backgroundImage:`url(${k.value})`,top:`${l.avatar.offset_y}px`,transform:`scale(${l.avatar.scale})`})),I=J(()=>({show:A.value,[w.value]:A.value&&w.value})),T=J(()=>({left:`${l.avatar.bubble_left}%`,top:`${l.avatar.bubble_top}%`,backgroundImage:`url(${M.value})`})),V=x=>{if(!x||x==="none")return;const E=Date.now(),q=`${x}?t=${E}`,z=new Image;z.onload=()=>{k.value=q},z.onerror=()=>{console.error(`åŠ è½½å¤´åƒå¤±è´¥: ${q}`),k.value="/api/v1/chat/character/get_avatar/æ­£å¸¸.png"},z.src=q};U(i,x=>{V(x)},{immediate:!0}),U(()=>l.avatar.character_id,x=>{V(i.value)}),U(()=>l.avatar.clothes_name,()=>{V(i.value)}),U(()=>l.avatar.emotion,x=>{const E=he[x];if(E){if(E.animation&&E.animation!=="none"&&(_.value=E.animation),E.bubbleImage&&E.bubbleImage!=="none"){const q=Date.now();M.value=`${E.bubbleImage}?t=${q}#t=0.1`,w.value=E.bubbleClass,A.value=!1,le(()=>{A.value=!0}),setTimeout(()=>{A.value=!1},2e3)}E.audio&&E.audio!=="none"&&d.value&&(d.value.src=E.audio,d.value.load(),d.value.play())}},{immediate:!0}),U(()=>a.currentAvatarAudio,x=>{c.value&&x&&x!=="None"&&(c.value.src=`${F.VOICE.BASE}/${x}`,c.value.load(),c.value.play())}),U(()=>a.characterVolume,x=>{c.value&&(c.value.volume=x/100)}),U(()=>a.bubbleVolume,x=>{d.value&&(d.value.volume=x/100)});const $=()=>{s("audio-ended")},C=()=>{_.value!=="normal"&&(_.value="normal")};return e({setEmotion:x=>{l.avatar.emotion=x}}),(x,E)=>(v(),g("div",{class:N([r.value,"absolute w-full h-full character-animation normal"]),onAnimationend:C},[t("div",{style:te(b.value),class:"avatar-img",id:"qinling"},null,4),t("div",{class:N([I.value,"bubble"]),style:te(T.value)},null,6),t("audio",{ref_key:"avatarAudio",ref:c,onEnded:$},null,544),t("audio",{ref_key:"bubbleAudio",ref:d},null,512)],34))}}),Ee={__name:"Rain",props:{enabled:{type:Boolean,default:!0},intensity:{type:Number,default:1,validator:n=>n>=0&&n<=2}},setup(n){const e=n,u=m(50),l=m(20),a=m([]),s=m(null),c=m(null),d=m(0),_=m(null);U(()=>e.intensity,w=>{u.value=Math.max(10,100-w*45)},{immediate:!0});const k=()=>{e.enabled&&(clearInterval(s.value),s.value=setInterval(()=>{const w={top:-100,left:`${~~(Math.random()*100)}%`,speed:10+Math.random()*10*e.intensity,size:30+Math.random()*40*e.intensity,opacity:.2+Math.random()*.5};a.value.push(w)},u.value))},A=()=>{e.enabled&&(clearInterval(c.value),c.value=setInterval(()=>{const w=a.value.filter(i=>i.top<d.value);w.forEach(i=>{i.top+=i.speed}),a.value=w},l.value))},M=()=>{_.value&&_.value.parentElement?d.value=_.value.parentElement.clientHeight:d.value=window.innerHeight};return Z(()=>{le(()=>{M(),e.enabled&&(k(),A())}),window.addEventListener("resize",M)}),fe(()=>{clearInterval(s.value),clearInterval(c.value),window.removeEventListener("resize",M)}),U(()=>e.enabled,w=>{w?(M(),k(),A()):(clearInterval(s.value),clearInterval(c.value),a.value=[])}),(w,i)=>(v(),g("div",{class:"rain-container",ref_key:"containerRef",ref:_},[(v(!0),g(O,null,Y(a.value,(r,b)=>(v(),g("span",{class:"rain-item",key:b,style:te({top:`${r.top}px`,left:r.left,height:`${r.size}px`,opacity:r.opacity})},null,4))),128))],512))}},Re=L(Ee,[["__scopeId","data-v-04812d89"]]),Ve=j({__name:"Sakura",props:{enabled:{type:Boolean,default:!0},intensity:{default:1}},setup(n){const e=n,u=m([]),l=m(null),a=m(0),s=m(Math.floor(25*e.intensity)),c=()=>Math.random().toString(36).substr(2,9),d=()=>{const i=Math.random()*10+10,r=Math.random()*window.innerWidth,b=-30,I=Math.random()*10+15,T=Math.random()*10,V=Math.random()*.5+.4,$=Math.random()*10+320,C=Math.random()*100-50;return{id:c(),size:i,left:r,top:b,opacity:V,hue:$,duration:I,delay:T,horizontalMovement:C}},_=i=>{const r=document.createElement("style");document.head.appendChild(r);const b=`
  @keyframes fall-${i.id} {
    0% {
      transform: translate(0, 0) rotate(0deg);
      opacity: ${i.opacity};
    }
    25% {
      transform: translate(${i.horizontalMovement*.25}px, ${a.value*.25}px) 
                 rotate(${90+Math.random()*90}deg);
      opacity: ${i.opacity*.9};
    }
    50% {
      transform: translate(${i.horizontalMovement*.5}px, ${a.value*.5}px) 
                 rotate(${180+Math.random()*90}deg);
      opacity: ${i.opacity*.7};
    }
    75% {
      transform: translate(${i.horizontalMovement*.75}px, ${a.value*.75}px) 
                 rotate(${270+Math.random()*90}deg);
      opacity: ${i.opacity*.5};
    }
    100% {
      transform: translate(${i.horizontalMovement}px, ${a.value}px) 
                 rotate(${360+Math.random()*180}deg);
      opacity: 0;
    }
  }
`;r.innerHTML=b,i.styleSheet=r},k=i=>{for(let r=0;r<i;r++){const b=d();_(b),u.value.push(b)}},A=()=>{u.value.forEach(i=>{i.styleSheet&&i.styleSheet.parentNode&&i.styleSheet.parentNode.removeChild(i.styleSheet)}),u.value=[]},M=()=>{l.value&&l.value.parentElement?a.value=l.value.parentElement.clientHeight:a.value=window.innerHeight},w=()=>{A(),k(s.value)};return U(()=>e.intensity,i=>{s.value=Math.floor(25*i),w()}),U(()=>e.enabled,i=>{i?(M(),k(s.value)):A()}),Z(()=>{le(()=>{M(),e.enabled&&k(s.value)}),window.addEventListener("resize",()=>{M(),w()})}),fe(()=>{A(),window.removeEventListener("resize",M)}),(i,r)=>(v(),g("div",{class:"petal-container",ref_key:"containerRef",ref:l},[(v(!0),g(O,null,Y(u.value,(b,I)=>(v(),g("div",{class:"petal",key:I,style:te({width:`${b.size}px`,height:`${b.size}px`,left:`${b.left}px`,top:`${b.top}px`,opacity:b.opacity,background:`linear-gradient(135deg, hsl(${b.hue}, 100%, 85%), hsl(${b.hue}, 100%, 75%))`,animation:`fall-${b.id} ${b.duration}s linear ${b.delay}s infinite`})},null,4))),128))],512))}}),ze=L(Ve,[["__scopeId","data-v-f258e642"]]),De=j({__name:"Snow",props:{enabled:{type:Boolean,default:!0},intensity:{default:1}},setup(n){const e=n,u=m([]),l=m(null),a=m(0),s=m(Math.floor(50*e.intensity)),c=["â„","â…","â†","â€¢","Â·"],d=()=>Math.random().toString(36).substr(2,9),_=()=>{const r=Math.random()*10+8,b=Math.random()*window.innerWidth,I=-30,T=Math.random()*15+20,V=Math.random()*10,$=Math.random()*.7+.3,C=Math.random()*100-50,y=c[Math.floor(Math.random()*c.length)]||"â„";return{id:d(),size:r,left:b,top:I,opacity:$,duration:T,delay:V,horizontalMovement:C,content:y}},k=r=>{const b=document.createElement("style");document.head.appendChild(b);const I=`
  @keyframes fall-${r.id} {
    0% {
      transform: translate(0, 0) rotate(0deg);
      opacity: ${r.opacity};
    }
    25% {
      transform: translate(${r.horizontalMovement*.25}px, ${a.value*.25}px) 
                 rotate(${Math.random()*90}deg);
      opacity: ${r.opacity*.95};
    }
    50% {
      transform: translate(${r.horizontalMovement*.5}px, ${a.value*.5}px) 
                 rotate(${Math.random()*180}deg);
      opacity: ${r.opacity*.9};
    }
    75% {
      transform: translate(${r.horizontalMovement*.75}px, ${a.value*.75}px) 
                 rotate(${Math.random()*270}deg);
      opacity: ${r.opacity*.8};
    }
    100% {
      transform: translate(${r.horizontalMovement}px, ${a.value}px) 
                 rotate(${Math.random()*360}deg);
      opacity: ${r.opacity*.4};;
    }
  }
`;b.innerHTML=I,r.styleSheet=b},A=r=>{for(let b=0;b<r;b++){const I=_();k(I),u.value.push(I)}},M=()=>{u.value.forEach(r=>{r.styleSheet&&r.styleSheet.parentNode&&r.styleSheet.parentNode.removeChild(r.styleSheet)}),u.value=[]},w=()=>{l.value&&l.value.parentElement?a.value=l.value.parentElement.clientHeight:a.value=window.innerHeight},i=()=>{M(),A(s.value)};return U(()=>e.intensity,r=>{s.value=Math.floor(50*r),i()}),U(()=>e.enabled,r=>{r?(w(),A(s.value)):M()}),Z(()=>{le(()=>{w(),e.enabled&&A(s.value)}),window.addEventListener("resize",()=>{w(),i()})}),fe(()=>{M(),window.removeEventListener("resize",w)}),(r,b)=>(v(),g("div",{class:"snow-container",ref_key:"containerRef",ref:l},[(v(!0),g(O,null,Y(u.value,(I,T)=>(v(),g("div",{class:"snowflake",key:T,style:te({width:`${I.size}px`,height:`${I.size}px`,left:`${I.left}px`,top:`${I.top}px`,opacity:I.opacity,animation:`fall-${I.id} ${I.duration}s linear ${I.delay}s infinite`})},S(I.content),5))),128))],512))}}),Ue=L(De,[["__scopeId","data-v-fe4bda82"]]),Pe={__name:"GameBackground",setup(n){const e=Q(),u=m(null),l=m(),a=m(),s=m(!0),c=m(200),d=m(.4),_=m(["rgb(173, 216, 230)","rgb(176, 224, 230)","rgb(241, 141, 252)","rgb(176, 230, 224)","rgb(173, 230, 216)"]),k=m(!0),A=m(1),M=m(1.5),w=J(()=>({backgroundImage:e.currentBackground?`url(${e.currentBackground})`:"url(@/assets/images/default_bg.jpg)"})),i=r=>{console.debug("Starfield ready",r)};return U(()=>e.currentSoundEffect,r=>{l.value&&r&&r!=="None"&&(l.value.src=r,l.value.load(),l.value.play())}),U(()=>e.currentBackgroundMusic,r=>{a.value&&r&&r!=="None"&&(a.value.src=r,a.value.load(),a.value.play())}),(r,b)=>(v(),g(O,null,[t("div",{class:"game-background",style:te(w.value)},[o(e).currentBackgroundEffect==="StarField"?(v(),W(Be,{key:0,ref_key:"starfieldRef",ref:u,enabled:s.value,"star-count":c.value,"scroll-speed":d.value,colors:_.value,onReady:i},null,8,["enabled","star-count","scroll-speed","colors"])):H("",!0),o(e).currentBackgroundEffect==="Rain"?(v(),W(Re,{key:1,enabled:k.value,intensity:A.value},null,8,["enabled","intensity"])):H("",!0),o(e).currentBackgroundEffect==="Sakura"?(v(),W(ze,{key:2,enabled:!0,intensity:1.5})):H("",!0),o(e).currentBackgroundEffect==="Snow"?(v(),W(Ue,{key:3,intensity:M.value,enabled:!0},null,8,["intensity"])):H("",!0),b[0]||(b[0]=B(" < ",-1))],4),t("audio",{ref_key:"soundEffectPlayer",ref:l},null,512),t("audio",{ref_key:"backgroundMusicPlayer",ref:a,loop:""},null,512)],64))}},je=L(Pe,[["__scopeId","data-v-4e9d7ad0"]]),Fe={name:"GlassInput",inheritAttrs:!1,props:{modelValue:{type:String,default:""}},emits:["update:modelValue"]},Oe={class:"form-group"},Le=["value"];function Ne(n,e,u,l,a,s){return v(),g("div",Oe,[t("input",Ce({type:"text",class:"form-control",value:u.modelValue,onInput:e[0]||(e[0]=c=>n.$emit("update:modelValue",c.target.value))},n.$attrs),null,16,Le)])}const He=L(Fe,[["render",Ne],["__scopeId","data-v-5fc9dd1e"]]),Ge=["min","max","step","value"],We=j({__name:"Slider",props:{value:{type:Number,require:!1},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1}},emits:["change","input"],setup(n,{emit:e}){const u=n,l=m(),a=_e();l.value=(u.min+u.max)/2;const s=J(()=>{if(a.default){const d=a.default();if(d&&d[0]&&typeof d[0].children=="string")return d[0].children.split("/")[0]||""}return""}),c=J(()=>{if(a.default){const d=a.default();if(d&&d[0]&&typeof d[0].children=="string")return d[0].children.split("/")[1]||""}return""});return(d,_)=>(v(),g("div",null,[t("span",null,[se(d.$slots,"left",{},()=>[B(S(s.value),1)],!0)]),G(t("input",{type:"range",min:n.min,max:n.max,step:n.step,value:l.value,onInput:_[0]||(_[0]=k=>d.$emit("input",Number(l.value))),onChange:_[1]||(_[1]=k=>d.$emit("change",Number(l.value))),"onUpdate:modelValue":_[2]||(_[2]=k=>l.value=k)},null,40,Ge),[[de,l.value]]),t("span",null,[se(d.$slots,"right",{},()=>[B(S(c.value),1)],!0)])]))}}),ce=L(We,[["__scopeId","data-v-3ccb63d0"]]),qe={__name:"Text",props:{speed:{type:Number,default:0}},setup(n){const e=n,u=m(),l=_e().default()[0].children;U(()=>e.speed,()=>s(e.speed));let a;const s=c=>{clearInterval(a),u.value="";let d=0;const _=200,A=_-(c-1)/99*(_-10);a=setInterval(()=>{d<l.length?(u.value+=l.charAt(d),d++):clearInterval(a)},A)};return(c,d)=>(v(),g("div",null,[t("p",null,S(u.value),1),d[0]||(d[0]=t("span",null,null,-1))]))}},Ke=L(qe,[["__scopeId","data-v-fbabe340"]]),Je=["id","checked"],Qe=["for"],Ye=j({__name:"Toggle",props:{checked:{type:Boolean,default:!1}},emits:["change"],setup(n,{emit:e}){const u=m(),l=m();return Z(()=>{u.value=Math.random().toString(36).substring(2,9)}),(a,s)=>(v(),g("div",null,[G(t("input",{type:"checkbox",id:u.value,checked:n.checked,onChange:s[0]||(s[0]=c=>a.$emit("change",l.value)),"onUpdate:modelValue":s[1]||(s[1]=c=>l.value=c)},null,40,Je),[[ye,l.value]]),t("label",{for:u.value},[se(a.$slots,"default",{},void 0,!0)],8,Qe)]))}}),ie=L(Ye,[["__scopeId","data-v-34dbb3da"]]);class Xe{element;timer=null;abortController;speed;isFinished;onFinishCallback;audioContext;soundBuffers;textBuffers;soundUrls;constructor(e){this.element=e,this.timer=null,this.abortController=null,this.speed=50,this.isFinished=!1,this.onFinishCallback=null,this.audioContext=null,this.soundBuffers=[],this.textBuffers="",this.soundUrls=["../audio_effects/å¯¹è¯.wav"]}async initAudio(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),await this.loadSounds()}catch(e){console.warn("éŸ³é¢‘åˆå§‹åŒ–å¤±è´¥:",e);const u=Q();u.enableChatEffectSound=!1}}async loadSounds(){if(this.audioContext)try{const e=this.soundUrls.map(async u=>{const a=await(await fetch(u)).arrayBuffer();return this.audioContext.decodeAudioData(a)});this.soundBuffers=await Promise.all(e)}catch(e){console.warn("éŸ³æ•ˆåŠ è½½å¤±è´¥:",e)}}playRandomSound(){if(!Q().enableChatEffectSound||!this.audioContext||this.soundBuffers.length===0)return;const u=this.soundBuffers[Math.floor(Math.random()*this.soundBuffers.length)],l=this.audioContext.createBufferSource();u&&(l.buffer=u),l.playbackRate.value=1;const a=this.audioContext.createGain();a.gain.value=.8,l.connect(a),a.connect(this.audioContext.destination),l.start()}setSoundEnabled(e){const u=Q();u.enableChatEffectSound=e,e&&!this.audioContext&&this.initAudio()}async start(e,u){const l=Q();this.stop(),this.isFinished=!1,u!==void 0?this.speed=Number.isInteger(u)?u:Number.parseInt(u.toString(),10)||50:(console.warn("é€Ÿåº¦å€¼æœªå®šä¹‰ï¼Œå°†é‡‡ç”¨é»˜è®¤é€Ÿåº¦ã€‚"),this.speed=50),this.abortController=new AbortController;let a=0;this.textBuffers="",l.enableChatEffectSound&&!this.audioContext&&await this.initAudio();const s=()=>{if(!this.abortController?.signal.aborted)if(a<e.length){this.textBuffers+=e.charAt(a),this.element.value=this.textBuffers,this.element.textContent=this.textBuffers,this.playRandomSound(),a++,this.element.scrollTop=this.element.scrollHeight;const c=this.speed*.8,d=this.speed*.4,_=c+Math.random()*d;this.timer=setTimeout(s,_)}else this.finish()};s()}finish(){this.stop(),this.isFinished=!0,this.element.style.borderRight="none",this.onFinishCallback&&this.onFinishCallback()}stop(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.abortController&&(this.abortController.abort(),this.abortController=null),this.isFinished=!1}clear(){this.element.value="",this.element.textContent="",this.textBuffers=""}checkFinished(){return this.isFinished}onFinish(e){this.onFinishCallback=e}}function Ze(n){const e=m(null),u=m(!1),l=()=>{n.value&&(e.value=new Xe(n.value))},a=async(c,d)=>{e.value||l(),u.value=!0,await e.value?.start(c,d),u.value=!1},s=()=>{e.value?.stop(),e.value?.clear(),u.value=!1};return fe(()=>{s()}),{startTyping:a,stopTyping:s,isTyping:u}}const et={class:"chatbox-box"},tt={class:"chatbox-main"},at={class:"chatbox-title-part"},nt={class:"chatbox-title"},st={id:"character"},ot={class:"chatbox-subtitle"},lt={id:"character-sub"},rt={class:"chatbox-emotion"},it={id:"character-emotion"},ut={class:"chatbox-inputbox"},ct=["placeholder","onKeydown","readonly"],dt=["disabled"],pt=j({__name:"GameDialog",emits:["player-continued","dialog-proceed"],setup(n,{expose:e,emit:u}){const l=m(""),a=m(null),s=re(),c=Q(),{startTyping:d,stopTyping:_}=Ze(a),k=J(()=>s.currentStatus==="thinking"),A=u,M=()=>{c.toggleSettings(!0),c.setSettingsTab("history")},w=J(()=>{switch(s.currentStatus){case"input":return c.showPlayerHintLine||"åœ¨è¿™é‡Œè¾“å…¥æ¶ˆæ¯...";case"thinking":return s.avatar.think_message;case"responding":case"presenting":return"";default:return"åœ¨è¿™é‡Œè¾“å…¥æ¶ˆæ¯..."}}),i=J(()=>s.currentStatus==="input");U(()=>s.currentStatus,T=>{console.log("æ¸¸æˆçŠ¶æ€å˜ä¸º :",T),T==="thinking"?(s.avatar.emotion="AIæ€è€ƒ",c.showCharacterTitle=s.avatar.character_name,c.showCharacterSubtitle=s.avatar.character_subtitle):T==="input"?(c.showCharacterTitle=s.avatar.user_name,c.showCharacterSubtitle=s.avatar.user_subtitle,c.showCharacterEmotion=""):T==="presenting"&&(c.showCharacterTitle="",c.showCharacterSubtitle="",c.showCharacterEmotion="",c.showCharacterLine="")}),U([()=>c.showCharacterLine,()=>s.currentStatus],([T,V])=>{T&&T!==""&&V==="responding"?(l.value="",d(T,c.typeWriterSpeed)):V==="input"&&(_(),l.value="")});function r(){s.currentStatus==="input"?b():s.currentStatus==="responding"&&I(!0)}function b(){const T=l.value;T.trim()&&(T==="/å¼€å§‹å‰§æœ¬"?(s.initializeScript("TODO: ä»Žå‰§æœ¬é¢æ¿é€‰æ‹©å‰§æœ¬"),s.avatar.show=!1,s.script.isRunning=!0):(s.currentStatus="thinking",s.addToDialogHistory({type:"message",character:s.avatar.user_name,content:T})),$e.sendMessage(T),l.value="")}function I(T){const V=Se.continue();return V||(T&&A("player-continued"),A("dialog-proceed")),V}return e({continueDialog:I}),(T,V)=>(v(),g("div",et,[t("div",tt,[t("div",at,[t("div",nt,[t("div",st,S(o(c).showCharacterTitle),1)]),t("div",ot,[t("div",lt,S(o(c).showCharacterSubtitle),1)]),t("div",rt,[t("div",it,S(o(c).showCharacterEmotion),1)]),p(o(D),{type:"nav",icon:"history",title:"",onClick:M})]),V[1]||(V[1]=t("div",{class:"chatbox-line"},null,-1)),t("div",ut,[G(t("textarea",{id:"inputMessage",ref_key:"textareaRef",ref:a,placeholder:w.value,"onUpdate:modelValue":V[0]||(V[0]=$=>l.value=$),onKeydown:ke(pe(r,["exact","prevent"]),["enter"]),readonly:!i.value},null,40,ct),[[de,l.value]]),t("button",{id:"sendButton",disabled:k.value,onClick:r},"â–¼",8,dt)])])]))}}),ft={class:"main-box"},vt={id:"menu-panel"},os=j({__name:"MainChat",setup(n){const e=Q(),u=re(),l=me(),a=m(null),s=m(null),c=()=>{e.toggleSettings(!0),e.setSettingsTab("text")},d=()=>{e.autoMode=!e.autoMode},_=async()=>{try{await u.initializeGame(l.client_id,"1"),a.value?a.value.setEmotion("æ­£å¸¸"):console.log("è¿™ä¸ªç»„ä»¶ä¸å­˜åœ¨")}catch(b){console.log(b)}};Z(()=>{l.client_id!==""&&_()}),U(()=>u.avatar.character_id,(r,b)=>{r&&r!==b&&(console.log(`Character ID changed to ${r}, re-initializing...`),_())}),U(()=>l.client_id,r=>{r&&_()});let k=null;const A=m(!1),M=()=>{A.value=!1,k&&(clearTimeout(k),k=null)},w=()=>{if(e.autoMode){if(A.value){console.log("çˆ¶ç»„ä»¶ï¼šéŸ³é¢‘ç»“æŸäº†ï¼Œä½†ç”¨æˆ·å·²æ‰‹åŠ¨ç»§ç»­ï¼Œä¸åšä»»ä½•äº‹ã€‚");return}u.currentStatus==="responding"&&(k&&clearTimeout(k),k=setTimeout(()=>{s.value?s.value.continueDialog(!1)&&w():console.error("æ— æ³•æ‰¾åˆ° GameDialog çš„å®žä¾‹ã€‚")},1e3))}},i=()=>{console.log("ç”¨æˆ·ä¸»åŠ¨ç‚¹å‡»äº†"),k&&(clearTimeout(k),k=null,console.log("çˆ¶ç»„ä»¶ï¼šå·²å–æ¶ˆè‡ªåŠ¨ç»§ç»­çš„å®šæ—¶å™¨ã€‚")),A.value?console.log("çˆ¶ç»„ä»¶ï¼šç”¨æˆ·é‡å¤ç‚¹å‡»ï¼Œä½†æ–¹æ³•å·²æ‰§è¡Œè¿‡ï¼Œä¸å†è°ƒç”¨ã€‚"):A.value=!0};return(r,b)=>(v(),g("div",ft,[p(o(je)),p(o(Te),{ref_key:"gameAvatarRef",ref:a,onAudioEnded:w},null,512),p(o(pt),{ref_key:"gameDialogRef",ref:s,onPlayerContinued:i,onDialogProceed:M},null,512),t("div",vt,[G(p(o(D),{type:"nav",icon:"play",onClick:d,class:N([{active:o(e).autoMode}])},{default:h(()=>[...b[0]||(b[0]=[t("h3",null,"è‡ªåŠ¨",-1)])]),_:1},8,["class"]),[[X,o(e).showSettings!==!0]]),G(p(o(D),{type:"nav",icon:"text",onClick:c},{default:h(()=>[...b[1]||(b[1]=[t("h3",null,"èœå•",-1)])]),_:1},512),[[X,o(e).showSettings!==!0]])])]))}}),ht=j({__name:"MenuItem",props:{title:{type:String,default:"é»˜è®¤æ ‡é¢˜"},size:{type:String,default:"large",validator:n=>["small","large"].includes(n)}},setup(n){return(e,u)=>(v(),g("section",{class:N(["menu-item",n.size])},[t("div",null,[t("h4",null,S(n.title),1)]),se(e.$slots,"default",{},void 0,!0)],2))}}),P=L(ht,[["__scopeId","data-v-38680f17"]]),mt={},gt={class:"flex flex-1 px-3 py-6 text-white text-shadow-2xs mx-auto items-start w-[70%] h-fit max-h-full flex-wrap gap-5"};function bt(n,e){return v(),g("div",gt,[se(n.$slots,"default")])}const ae=L(mt,[["render",bt]]),_t=async n=>{try{return await ee.get("/v1/chat/history/list",{params:n})}catch(e){throw new Error(e.response?.data?.message||"èŽ·å–å­˜æ¡£åˆ—è¡¨å¤±è´¥")}},yt=async n=>{try{await ee.post("/v1/chat/history/create",n)}catch(e){throw new Error(e.response?.data?.detail||"å­˜æ¡£åˆ›å»ºå¤±è´¥")}},kt=async n=>{try{return await ee.get("/v1/chat/history/load",{params:n})}catch(e){throw new Error(e.response?.data?.detail||"å­˜æ¡£åŠ è½½å¤±è´¥")}},xt=async n=>{try{await ee.post("/v1/chat/history/save",n)}catch(e){throw new Error(e.response?.data?.detail||"å­˜æ¡£ä¿å­˜å¤±è´¥")}},wt=async n=>{try{await ee.post("/v1/chat/history/delete",n)}catch(e){throw new Error(e.response?.data?.detail||"å­˜æ¡£åˆ é™¤å¤±è´¥")}},Ct={class:"new-save-form"},$t={class:"save-section"},St={class:"save-list-container"},At={key:0,class:"status-message"},Bt={key:1,class:"status-message error"},It={key:2,class:"status-message"},Mt={key:3,class:"save-list"},Tt={class:"save-info"},Et={class:"save-title"},Rt={class:"save-date"},Vt={class:"save-actions"},zt=["onClick"],Dt=["onClick"],Ut=["onClick"],oe="1",Pt=j({__name:"SettingsSave",setup(n){const e=re(),u=me(),l=m([]),a=m(""),s=m(!1),c=m(null),d=i=>{const r=new Date(i);return`${r.getFullYear()}.${r.getMonth()+1}.${r.getDate()}`},_=async()=>{s.value=!0,c.value=null;try{const i=await _t({user_id:oe,page:1,page_size:10});l.value=i.conversations}catch(i){console.error("èŽ·å–å­˜æ¡£åˆ—è¡¨å¤±è´¥:",i),c.value=i.message||"æœªçŸ¥é”™è¯¯"}finally{s.value=!1}},k=async()=>{if(!a.value.trim()){alert("è¯·è¾“å…¥å­˜æ¡£åç§°ï¼");return}try{await yt({user_id:oe,title:a.value.trim()}),a.value="",await _()}catch(i){console.error("åˆ›å»ºå­˜æ¡£å¤±è´¥:",i),alert(`åˆ›å»ºå¤±è´¥: ${i.message}`)}},A=async i=>{try{const r=await kt({user_id:oe,conversation_id:i});alert(`å­˜æ¡£ [${i}] è¯»å–æˆåŠŸ!`),e.initializeGame(u.client_id,oe)}catch(r){console.error("è¯»å–å­˜æ¡£å¤±è´¥:",r),alert(`è¯»å–å¤±è´¥: ${r.message}`)}},M=async i=>{try{await xt({user_id:oe,conversation_id:i}),alert(`æˆåŠŸè¦†ç›–å­˜æ¡£ [${i}]!`),await _()}catch(r){console.error("ä¿å­˜æ¸¸æˆå¤±è´¥:",r),alert(`ä¿å­˜å¤±è´¥: ${r.message}`)}},w=async i=>{if(confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå­˜æ¡£å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚"))try{await wt({user_id:oe,conversation_id:i}),await _()}catch(r){console.error("åˆ é™¤å­˜æ¡£å¤±è´¥:",r),alert(`åˆ é™¤å¤±è´¥: ${r.message}`)}};return Z(()=>{_()}),(i,r)=>(v(),W(o(ae),null,{default:h(()=>[p(o(P),{title:"åˆ›å»ºæ–°å­˜æ¡£"},{default:h(()=>[t("div",Ct,[p(o(He),{type:"text",modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=b=>a.value=b),placeholder:"è¾“å…¥å­˜æ¡£åç§°",onKeyup:ke(k,["enter"])},null,8,["modelValue"]),t("button",{class:"glass-effect action-btn-create",onClick:k},"åˆ›å»º")])]),_:1}),p(o(P),{title:"å­˜æ¡£åˆ—è¡¨"},{default:h(()=>[t("div",$t,[t("div",St,[s.value?(v(),g("div",At,"åŠ è½½ä¸­...")):c.value?(v(),g("div",Bt,"åŠ è½½å¤±è´¥: "+S(c.value),1)):l.value.length===0?(v(),g("div",It,"æš‚æ— å­˜æ¡£è®°å½•")):(v(),g("div",Mt,[(v(!0),g(O,null,Y(l.value,b=>(v(),g("div",{key:b.id,class:"save-card glass-effect"},[t("div",Tt,[t("span",Et,S(b.title||"æœªå‘½åå­˜æ¡£"),1),t("span",Rt,S(d(b.updated_at)),1)]),t("div",Vt,[t("button",{onClick:I=>A(b.id),class:"glass-effect action-btn-load"}," è¯»å– ",8,zt),t("button",{onClick:I=>M(b.id),class:"action-btn-save glass-effect"}," ä¿å­˜ ",8,Dt),t("button",{onClick:I=>w(b.id),class:"action-btn-delete glass-effect"}," åˆ é™¤ ",8,Ut)])]))),128))]))])])]),_:1})]),_:1}))}}),jt=L(Pt,[["__scopeId","data-v-1fd2e964"]]),Ft=j({__name:"SettingsText",setup(n){const e=m(),u=Q(),l=c=>{e.value=c,u.typeWriterSpeed=c},a=c=>{console.log(c)},s=c=>{u.enableChatEffectSound=c};return(c,d)=>(v(),W(o(ae),null,{default:h(()=>[p(o(P),{title:"âš¡ æ–‡å­—æ˜¾ç¤ºé€Ÿåº¦"},{default:h(()=>[p(o(ce),{onChange:l},{default:h(()=>[...d[0]||(d[0]=[B("æ…¢/å¿«",-1)])]),_:1})]),_:1}),p(o(P),{title:"ðŸ“ æ˜¾ç¤ºæ–‡å­—æ ·æœ¬"},{default:h(()=>[p(o(Ke),{speed:e.value},{default:h(()=>[...d[1]||(d[1]=[B("Ling Chat: æµ‹è¯•æ–‡æœ¬æ˜¾ç¤ºé€Ÿåº¦",-1)])]),_:1},8,["speed"])]),_:1}),p(o(P),{title:"âœ¨ é¡µé¢åˆ‡æ¢åŠ¨ç”»",size:"small"},{default:h(()=>[p(o(ie),{onChange:a},{default:h(()=>[...d[2]||(d[2]=[B("å¯ç”¨åŠ¨ç”»æ•ˆæžœ",-1)])]),_:1})]),_:1}),p(o(P),{title:"ðŸŒ è¯­éŸ³éŸ³æ•ˆå¼€å…³",size:"small"},{default:h(()=>[p(o(ie),{onChange:s},{default:h(()=>[...d[3]||(d[3]=[B("å¯ç”¨æ— vitsæ—¶çš„å¯¹è¯éŸ³æ•ˆ",-1)])]),_:1})]),_:1}),p(o(P),{title:"âœ¨ WebSocketé€šä¿¡çŠ¶æ€",size:"small"},{default:h(()=>[...d[4]||(d[4]=[t("p",null,"âˆš è¿žæŽ¥æ­£å¸¸",-1)])]),_:1}),p(o(P),{title:"âš™ å½“å‰ä½¿ç”¨çš„AIå¤§æ¨¡åž‹",size:"small"},{default:h(()=>[...d[5]||(d[5]=[t("p",null,"DeepSeek V3",-1)])]),_:1})]),_:1}))}}),Ot=L(Ft,[["__scopeId","data-v-28addd9a"]]),Lt=async()=>{try{return await ee.get("/v1/chat/back-music/list")}catch(n){throw new Error(n.response?.data?.message||"èŽ·å–éŸ³ä¹åˆ—è¡¨å¤±è´¥")}},Nt=async n=>{try{await ee.post("/v1/chat/back-music/upload",n)}catch(e){throw new Error(e.response?.data?.detail||"å­˜æ¡£ä¸Šä¼ å¤±è´¥")}},Ht=async n=>{try{await ee.delete("/v1/chat/back-music/delete",{params:{url:n}})}catch(e){throw new Error(e.response?.data?.detail||"å­˜æ¡£ä¸Šä¼ å¤±è´¥")}},Gt={class:"sound-test"},Wt={class:"music-controls"},qt={class:"music-name"},Kt={class:"music-list-container"},Jt={key:0,class:"empty-list"},Qt=["onClick"],Yt={class:"music-item-name"},Xt={class:"music-upload"},Zt=j({__name:"SettingsSound",setup(n){const e=Q(),u=m(null),l=m(null),a=m(null),s=m([]),c=m("æœªé€‰æ‹©éŸ³ä¹"),d=m(!1),_=m(null),k=m(null),A=f=>{u.value&&(u.value.volume=f/100)},M=f=>{l.value&&(l.value.volume=f/100)},w=f=>{a.value&&(a.value.volume=f/100)};U(()=>e.backgroundVolume,f=>{a.value&&(a.value.volume=f/100)});const i=()=>{u.value&&(u.value.src="/audio_effects/è§’è‰²éŸ³é‡æµ‹è¯•.wav",u.value.play().catch(f=>console.error("æµ‹è¯•è§’è‰²éŸ³é‡æ’­æ”¾å¤±è´¥:",f)))},r=()=>{l.value&&(l.value.src="/audio_effects/ç–‘é—®.wav",l.value.play().catch(f=>console.error("æµ‹è¯•æ°”æ³¡éŸ³é‡æ’­æ”¾å¤±è´¥:",f)))},b=async()=>{s.value=await Lt()},I=async f=>{if(!f){console.log("musicå¯¹è±¡ä¸å­˜åœ¨");return}if(confirm(`ç¡®å®šè¦åˆ é™¤ã€Š${f.name}ã€‹å—ï¼Ÿ`))try{await Ht(f.url),console.log(`æ­£åœ¨åˆ é™¤éŸ³ä¹: ${f.url}`),alert(`ã€Š${f.name}ã€‹åˆ é™¤æˆåŠŸ`),await b()}catch(R){console.error("åˆ é™¤éŸ³ä¹å¤±è´¥:",R),alert("åˆ é™¤éŸ³ä¹å¤±è´¥")}},T=async()=>{if(!_.value){alert("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªéŸ³ä¹æ–‡ä»¶");return}const f=_.value,R=[".mp3",".wav",".flac",".webm",".weba",".ogg",".m4a"],K=f.name.slice(f.name.lastIndexOf(".")).toLowerCase();if(!R.includes(K)){alert("ä¸æ”¯æŒçš„éŸ³é¢‘æ ¼å¼ã€‚è¯·ä¸Šä¼ : "+R.join(", "));return}const ue=new FormData;ue.append("file",f);try{await Nt(ue),console.log(`æ­£åœ¨ä¸Šä¼ æ–‡ä»¶: ${f.name}`),alert("éŸ³ä¹ä¸Šä¼ æˆåŠŸ"),_.value=null,k.value&&(k.value.value=""),await b()}catch(we){console.error("ä¸Šä¼ éŸ³ä¹å¤±è´¥:",we),alert("éŸ³ä¹ä¸Šä¼ å¤±è´¥")}},V=J(()=>d.value?"â¸ æš‚åœ":"â–¶ æ’­æ”¾"),$=f=>{if(!a.value)return;const R=`/api/v1/chat/back-music/music_file/${encodeURIComponent(f.url)}`;a.value.src=R,a.value.play().catch(K=>console.error("æ’­æ”¾éŸ³ä¹å¤±è´¥:",K)),c.value=f.name,d.value=!0},C=()=>{a.value&&(d.value?a.value.pause():!a.value.src&&s.value.length>0?$(s.value[0]||{name:"",url:""}):a.value.play().catch(f=>console.error("æ¢å¤æ’­æ”¾å¤±è´¥:",f)),d.value=!a.value.paused)},y=()=>{a.value&&(a.value.pause(),a.value.currentTime=0,d.value=!1)},x=()=>{k.value?.click()},E=f=>{const R=f.target;R.files&&R.files.length>0?_.value=R.files?.[0]||null:_.value=null},q=()=>{a.value&&(d.value=!a.value.paused)},z=()=>{d.value=!1};return Z(()=>{b(),u.value&&(u.value.volume=e.characterVolume/100),l.value&&(l.value.volume=e.bubbleVolume/100),a.value&&(a.value.volume=e.backgroundVolume/100)}),(f,R)=>(v(),W(o(ae),null,{default:h(()=>[p(o(P),{title:"ðŸ‘© è§’è‰²éŸ³é‡",size:"small"},{default:h(()=>[p(o(ce),{modelValue:o(e).characterVolume,"onUpdate:modelValue":R[0]||(R[0]=K=>o(e).characterVolume=K),onChange:A},{default:h(()=>[...R[3]||(R[3]=[B(" å¼±/å¼º ",-1)])]),_:1},8,["modelValue"])]),_:1}),p(o(P),{title:"ðŸ’¬ æ°”æ³¡éŸ³é‡",size:"small"},{default:h(()=>[p(o(ce),{onChange:M,modelValue:o(e).bubbleVolume,"onUpdate:modelValue":R[1]||(R[1]=K=>o(e).bubbleVolume=K)},{default:h(()=>[...R[4]||(R[4]=[B(" å¼±/å¼º ",-1)])]),_:1},8,["modelValue"])]),_:1}),p(o(P),{title:"ðŸŽ¶ èƒŒæ™¯éŸ³é‡",size:"small"},{default:h(()=>[p(o(ce),{onChange:w,modelValue:o(e).backgroundVolume,"onUpdate:modelValue":R[2]||(R[2]=K=>o(e).backgroundVolume=K)},{default:h(()=>[...R[5]||(R[5]=[B(" å¼±/å¼º ",-1)])]),_:1},8,["modelValue"])]),_:1}),p(o(P),{title:"ðŸ”Š å£°éŸ³æµ‹è¯•",size:"small"},{default:h(()=>[t("div",Gt,[p(o(D),{type:"big",onClick:i},{default:h(()=>[...R[6]||(R[6]=[B("æµ‹è¯•è§’è‰²éŸ³é‡",-1)])]),_:1}),p(o(D),{type:"big",onClick:r},{default:h(()=>[...R[7]||(R[7]=[B("æµ‹è¯•æ°”æ³¡éŸ³é‡",-1)])]),_:1})])]),_:1}),p(o(P),{title:"âš™ èƒŒæ™¯éŸ³ä¹è®¾ç½®"},{default:h(()=>[t("div",Wt,[p(o(D),{type:"big",onClick:C,class:"left-button"},{default:h(()=>[B(S(V.value),1)]),_:1}),p(o(D),{type:"big",onClick:y,class:"left-button"},{default:h(()=>[...R[8]||(R[8]=[B("â–  åœæ­¢",-1)])]),_:1}),t("span",qt,"å½“å‰: "+S(c.value),1)]),t("div",Kt,[s.value.length===0?(v(),g("div",Jt,"æš‚æ— éŸ³ä¹ï¼Œè¯·ä¸Šä¼ ")):H("",!0),(v(!0),g(O,null,Y(s.value,K=>(v(),g("div",{key:K.url,class:"music-item",onClick:ue=>$(K)},[t("div",Yt,S(K.name),1),p(o(D),{onClick:ue=>I(K),class:"action-btn-delete glass-effect"},{default:h(()=>[...R[9]||(R[9]=[B("åˆ é™¤",-1)])]),_:1},8,["onClick"])],8,Qt))),128))]),t("div",Xt,[p(o(D),{type:"big",onClick:x},{default:h(()=>[...R[10]||(R[10]=[B("âž• æ·»åŠ éŸ³ä¹",-1)])]),_:1}),t("input",{ref_key:"fileInput",ref:k,type:"file",onChange:E,accept:".mp3,.wav,.flac,.webm,.weba,.ogg,.m4a",style:{display:"none"}},null,544),p(o(D),{type:"big",onClick:T,disabled:!_.value},{default:h(()=>[...R[11]||(R[11]=[B("ç¡®è®¤ä¸Šä¼ ",-1)])]),_:1},8,["disabled"])])]),_:1}),t("audio",{ref_key:"characterTestPlayer",ref:u},null,512),t("audio",{ref_key:"bubbleTestPlayer",ref:l},null,512),t("audio",{ref_key:"backgroundAudioPlayer",ref:a,loop:"",onTimeupdate:q,onEnded:z},null,544)]),_:1}))}}),ea=L(Zt,[["__scopeId","data-v-a1264955"]]),ta={class:"h-[87vh] w-full bg-white/10 p-0 md:p-4 rounded-lg overflow-auto"},aa={class:"block md:grid grid-cols-[280px_1fr] h-full"},na={key:0,class:"fixed inset-0 bg-white/80 flex justify-center items-center z-50"},sa={class:"text-base font-bold px-3.75 py-2.5 block rounded-lg mb-1 text-brand bg-white/10 backdrop-blur-xl backdrop-saturate-150 border border-white/10 shadow-[0_8px_32px_rgba(0,0,0,0.1),inset_0_1px_1px_rgba(255,255,255,0.1)]"},oa=["onClick"],la={class:"flex justify-center h-full overflow-auto relative -top-full md:top-0 px-10 py-10 md:px-10 md:py-0"},ra={key:0,class:"w-full active"},ia={class:"pt-2.5 overflow-auto"},ua={class:"pb-4 mb-6 border-b border-brand"},ca={class:"m-0 text-2xl text-brand font-semibold"},da={class:"mt-2 text-base"},pa={class:"inline-flex items-center cursor-pointer font-medium text-brand"},fa=["id","checked","onChange"],va={class:"text-sm mt-1 mb-2 text-gray-300"},ha=["for"],ma={class:"text-sm mt-1 mb-2 text-gray-300"},ga=["id","onUpdate:modelValue"],ba=["for"],_a={class:"text-sm mt-1 mb-2 text-gray-300"},ya=["id","onUpdate:modelValue"],ka={class:"w-18 px-5 py-2.5 bg-brand text-white border-none rounded-lg cursor-pointer text-sm font-medium transition-colors duration-200 hover:bg-[#0056b3]"},xa={key:1,class:"w-full active"},wa=j({__name:"SettingsAdvance",emits:["remove-more-menu-from-b"],setup(n,{expose:e,emit:u}){const l=m(!1),a=m({}),s=ge({category:null,subcategory:null}),c=ge({message:"",color:"var(--success-color)"}),d=u,_=m(null),k=m(null),A=J(()=>s.category&&s.subcategory?a.value[s.category]?.subcategories[s.subcategory]:null),M=(C,y)=>s.category===C&&s.subcategory===y,w=(C,y)=>{s.category=C,s.subcategory=y},i=(C,y)=>{C.value=y?"true":"false"},r=async()=>{if(!A.value)return;const C={};A.value.settings.forEach(y=>{C[y.key]=y.value}),l.value=!0,c.message="";try{const y=await fetch("/api/settings/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)}),x=await y.json();if(!y.ok)throw new Error(x.detail||"ä¿å­˜å¤±è´¥");c.message=x.message,c.color="var(--success-color)",await b(!1)}catch(y){c.message=`é”™è¯¯: ${y.message}`,c.color="red"}finally{l.value=!1,setTimeout(()=>{c.message=""},5e3)}},b=async(C=!0)=>{l.value=!0;try{const y=await fetch("/api/settings/config");if(!y.ok)throw new Error("æ— æ³•åŠ è½½é…ç½®");if(a.value=await y.json(),C&&Object.keys(a.value).length>0){const x=Object.keys(a.value)[0];if(x){const E=Object.keys(a.value[x]?.subcategories||{})[0];x&&E&&w(x,E)}}}catch(y){console.error(y),c.message=`åŠ è½½é…ç½®å¤±è´¥: ${y.message}`,c.color="red"}finally{l.value=!1}},I=()=>{if(!_.value||!k.value)return;const C=_.value.querySelector(".adv-nav-link.active");if(C){const y=C.offsetTop,x=C.offsetHeight;y&&(k.value.style.top=`${y}px`),x&&(k.value.style.height=`${x}px`)}},T=()=>{if(!_.value)return;new ResizeObserver(y=>{I()}).observe(_.value)};U(s,async()=>{await le(),I()},{deep:!0}),Z(async()=>{await b(),await le(),I(),T()});const V=()=>{const C=_.value;C&&C.classList.add("moreMenu")},$=()=>{const C=_.value;C&&C.classList.remove("moreMenu"),d("remove-more-menu-from-b")};return e({addMoreMenu:V}),(C,y)=>(v(),W(o(ae),null,{default:h(()=>[t("div",ta,[t("div",aa,[l.value?(v(),g("div",na,[...y[1]||(y[1]=[t("div",{class:"border-5 border-gray-200 border-t-brand rounded-full w-12 h-12 animate-spin"},null,-1)])])):H("",!0),t("nav",{ref_key:"navContainerRef",ref:_,onClick:y[0]||(y[0]=()=>$()),class:"-left-full md:left-0 blur transition-all duration-300 ease-[cubic-bezier(0.18,0.89,0.32,1.00)] md:blur-none h-full p-5 flex flex-col justify-start gap-6.25 overflow-y-auto relative border-r border-brand md:moreMenu:left-0"},[t("div",{ref_key:"indicatorRef",ref:k,class:"absolute left-5 w-[calc(100%-40px)] bg-brand rounded-lg z-0 transition-all duration-300 ease-[cubic-bezier(0.18,0.89,0.32,1.00)]"},null,512),(v(!0),g(O,null,Y(a.value,(x,E)=>(v(),g("div",{key:E,class:"flex flex-col gap-1 w-full"},[t("span",sa,S(E),1),(v(!0),g(O,null,Y(x.subcategories,(q,z)=>(v(),g("a",{key:z,href:"#",class:N(["block px-5 py-3 no-underline rounded-lg text-white transition-colors duration-200 relative z-10 adv-nav-link hover:bg-gray-200 hover:text-black active:text-white active:font-bold",{active:M(E,z.toString())}]),onClick:pe(f=>w(E,z.toString()),["prevent"])},S(z),11,oa))),128))]))),128))],512),t("main",la,[A.value?(v(),g("div",ra,[t("div",ia,[t("header",ua,[t("h2",ca,S(s.subcategory),1),t("p",da,S(A.value.description||`ä¿®æ”¹ ${s.subcategory} çš„ç›¸å…³é…ç½®`),1)]),t("form",{onSubmit:pe(r,["prevent"])},[(v(!0),g(O,null,Y(A.value.settings,x=>(v(),g("div",{key:x.key,class:"mb-6"},[x.type==="bool"?(v(),g(O,{key:0},[t("label",pa,[t("input",{class:"mr-2.5 w-4 h-4",type:"checkbox",id:x.key,checked:x.value.toLowerCase()==="true",onChange:E=>i(x,E.target.checked)},null,40,fa),B(" "+S(x.key),1)]),t("p",va,S(x.description||""),1)],64)):x.type==="textarea"?(v(),g(O,{key:1},[t("label",{class:"inline-flex items-center cursor-pointer font-medium text-brand",for:x.key},S(x.key),9,ha),t("p",ma,S(x.description||"æ”¯æŒå¤šè¡Œè¾“å…¥"),1),G(t("textarea",{id:x.key,"onUpdate:modelValue":E=>x.value=E,class:"w-full px-3 py-2.5 border rounded-lg text-sm text-white bg-white/10 backdrop-blur-xl backdrop-saturate-150 border-white/10 shadow-glass focus:outline-none focus:border-brand focus:ring-2 focus:ring-brand/20 transition-all duration-200",rows:"8"},null,8,ga),[[de,x.value]])],64)):(v(),g(O,{key:2},[t("label",{class:"inline-flex items-center cursor-pointer font-medium text-brand",for:x.key},S(x.key),9,ba),t("p",_a,S(x.description||""),1),G(t("input",{type:"text",id:x.key,"onUpdate:modelValue":E=>x.value=E,class:"w-full px-3 py-2.5 border rounded-lg text-sm text-white bg-white/10 backdrop-blur-xl backdrop-saturate-150 border-white/10 shadow-glass focus:outline-none focus:border-brand focus:ring-2 focus:ring-brand/20 transition-all duration-200"},null,8,ya),[[de,x.value]])],64))]))),128))],32),t("div",ka,[t("button",{onClick:r},"ä¿å­˜"),t("p",{style:te({color:c.color})},S(c.message),5)])])])):!l.value&&!Object.keys(a.value).length?(v(),g("div",xa,[...y[2]||(y[2]=[t("div",{class:"advanced-settings-container"},[t("header",null,[t("h2",{class:"adv-title"},"åŠ è½½å¤±è´¥"),t("p",{class:"adv-description"},"æ— æ³•åŠ è½½é…ç½®æˆ–é…ç½®ä¸ºç©ºã€‚")])],-1)])])):H("",!0)])])])]),_:1}))}}),Ca={class:"name"},$a={class:"content"},Sa=j({__name:"DialogUser",props:{name:{type:String,require:!0},content:{type:String,require:!0}},setup(n){return(e,u)=>(v(),g(O,null,[t("span",Ca,S(n.name),1),u[0]||(u[0]=t("span",null,": ",-1)),t("span",$a,S(n.content),1)],64))}}),Aa=L(Sa,[["__scopeId","data-v-83c8a706"]]),Ba=["title"],Ia={class:"name"},Ma={class:"content"},Ta={class:"icon"},Ea=j({__name:"DialogCharacter",props:{name:{type:String,require:!0},content:{type:String,require:!0},emotionTag:{type:String,require:!0},emotionText:{type:String,require:!0}},emits:["click"],setup(n,{emit:e}){return(u,l)=>(v(),g("div",{class:"message",title:`æƒ…æ„Ÿ: ${n.emotionTag}`},[t("span",Ia,S(n.name),1),l[1]||(l[1]=t("span",{class:"symbol"},":Â ",-1)),t("span",Ma,S(n.content),1),l[2]||(l[2]=t("span",{class:"symbol"},"Â ",-1)),t("span",Ta,[p(o(xe),{icon:"volume",onClick:l[0]||(l[0]=a=>u.$emit("click"))})])],8,Ba))}}),Ra=L(Ea,[["__scopeId","data-v-19dcc4bc"]]),Va={class:"message-item"},za={key:0,class:"player-message"},Da={key:1,class:"chararter-reply"},Ua={key:2,class:"final-spacer"},Pa=j({__name:"DialogSession",props:{dialog:{type:Array,require:!0}},setup(n){const e=m(null);function u(l){e.value.src=`${F.VOICE.BASE}/${l}`,e.value.play()}return(l,a)=>(v(),g(O,null,[(v(!0),g(O,null,Y(n.dialog,s=>(v(),g("div",Va,[s.type==="message"?(v(),g("div",za,[p(Aa,{name:s.character,content:s.content},null,8,["name","content"])])):s.type==="reply"?(v(),g("div",Da,[p(Ra,{name:s.character,content:s.content,emotionTag:s.originalTag,emotionText:s.motionText,onClick:c=>u(s.audioFile)},null,8,["name","content","emotionTag","emotionText","onClick"])])):H("",!0),s.isFinal?(v(),g("div",Ua)):H("",!0)]))),256)),t("audio",{ref_key:"audio",ref:e,autoplay:""},null,512)],64))}}),ja=L(Pa,[["__scopeId","data-v-0ebba481"]]),Fa={class:"history-container"},Oa={key:0,class:"status-message"},La=j({__name:"SettingsHistory",setup(n){const e=re(),u=J(()=>e.dialogHistory),l=m(null);return(a,s)=>(v(),W(o(ae),null,{default:h(()=>[p(o(P),{title:"â—ˆ åŽ†å²å¯¹è¯"},{default:h(()=>[t("div",Fa,[u.value.length===0?(v(),g("div",Oa," æš‚æ— åŽ†å²è®°å½•ï¼ŒåŽ»å’ŒtaèŠèŠå¤©å­(*^â–½^*) ")):(v(),g("div",{key:1,class:"chat-history-container",ref_key:"chatContainer",ref:l},[p(ja,{dialog:u.value},null,8,["dialog"])],512))])]),_:1})]),_:1}))}}),Na=L(La,[["__scopeId","data-v-ba2d0809"]]),Ha=j({__name:"SettingsSchedule",setup(n){return(e,u)=>(v(),W(o(ae),null,{default:h(()=>[p(o(P),{title:"ä¸»åŠ¨æé†’ï¼ˆè¯·åŽ»é«˜çº§è®¾ç½®-å®žéªŒåŠŸèƒ½è®¾ç½®ï¼‰",size:"small"},{default:h(()=>[p(o(ie),null,{default:h(()=>[...u[0]||(u[0]=[B("æ˜¯å¦å¼€å¯æ—¥ç¨‹ä¸»åŠ¨æé†’åŠŸèƒ½",-1)])]),_:1})]),_:1}),p(o(P),{title:"éšæœºèŠå¤©ï¼ˆæ•¬è¯·æœŸå¾…ï¼‰",size:"small"},{default:h(()=>[p(o(ie),null,{default:h(()=>[...u[1]||(u[1]=[B("æ˜¯å¦å¼€å¯éšæœºé—´éš”ä¸»åŠ¨èŠå¤©åŠŸèƒ½",-1)])]),_:1})]),_:1}),p(o(P),{title:"çª¥å±æƒé™ï¼ˆæ•¬è¯·æœŸå¾…ï¼‰",size:"small"},{default:h(()=>[p(o(ie),null,{default:h(()=>[...u[2]||(u[2]=[B("æ˜¯å¦å¼€å¯ä¸»åŠ¨çª¥å±èŠå¤©åŠŸèƒ½",-1)])]),_:1})]),_:1}),p(o(P),{title:"æ—¥ç¨‹åˆ—è¡¨ï¼ˆæ•¬è¯·æœŸå¾…ï¼‰",size:"large"},{default:h(()=>[...u[3]||(u[3]=[B(" æ—¥ç¨‹ç»„ä»¶ ",-1)])]),_:1})]),_:1}))}}),Ga={class:"flex bg-white/10 backdrop-blur-[20px] backdrop-saturate-180 rounded-2xl shadow-[0_4px_12px_rgba(0,0,0,0.08)] overflow-hidden transition-all duration-300 ease-[cubic-bezier(0.25,0.8,0.25,1)] border border-black/5 h-45 w-full hover:-translate-y-0.75 hover:shadow-[0_6px_16px_rgba(0,0,0,0.12)] md:h-45 max-md:h-30"},Wa={class:"w-45 h-45 p-2.5 flex items-center justify-center bg-[#f8f9fa] border-r border-black/5 rounded-2xl max-md:w-25 max-md:h-25"},qa=["src","alt"],Ka={class:"flex-1 flex flex-col p-3 relative"},Ja={class:"font-semibold text-white mb-2 font-['Segoe_UI',Tahoma,Geneva,Verdana,sans-serif] text-[16px] md:text-[18px]"},Qa={class:"text-[#f8f9fa] leading-[1.4] overflow-y-auto mb-2 text-[12px] h-10 md:text-[13px] md:h-15"},Ya={class:"character-actions"},Xa=j({__name:"CharacterCard",props:{avatar:{},name:{},info:{},clothes:{},selectClothes:{},isClothesSelected:{}},setup(n){return(e,u)=>(v(),g("div",Ga,[t("div",Wa,[t("img",{src:n.avatar,alt:n.name,class:"w-45 h-45 object-contain rounded-lg p-1.25 shadow-[0_2px_4px_rgba(0,0,0,0.05)] max-md:w-21.25 max-md:h-21.25"},null,8,qa)]),t("div",Ka,[t("h5",Ja,S(n.name),1),t("p",Qa,S(n.info),1),t("div",Ya,[se(e.$slots,"actions")])])]))}}),Za={},en={class:"grid grid-cols-1 gap-5"};function tn(n,e){return v(),g("div",en,[se(n.$slots,"default")])}const an=L(Za,[["render",tn]]),nn=async()=>{try{return await ee.get("/v1/chat/character/get_all_characters")}catch(n){throw new Error(n.response?.data?.message||"èŽ·å–è§’è‰²åˆ—è¡¨å¤±è´¥")}},sn=async n=>{try{return await ee.post("/v1/chat/character/select_character",n)}catch(e){throw new Error(e.response?.data?.detail||"è§’è‰²é€‰æ‹©å¤±è´¥")}},on={class:"character-list character-grid grid gap-5 p-3.75 w-full"},ln={class:"p-[24px_30px] border-b border-white/10 flex items-center justify-between bg-[linear-gradient(180deg,rgba(255,255,255,0.1)_0%,rgba(255,255,255,0.05)_100%)] md:p-[16px_20px]"},rn={class:"flex items-center gap-4 max-[480px]:gap-3"},un=["src","alt"],cn={class:"text-[24px] font-bold text-white m-0 text-shadow-[0_2px_8px_rgba(0,0,0,0.3)] md:text-[20px]"},dn={class:"m p-7.5 overflow-y-auto flex-1 md:p-5"},pn={key:0,class:"grid gap-5 grid-cols-[repeat(auto-fill,minmax(150px,1fr))] md:gap-3.75 md:grid-cols-[repeat(auto-fill,minmax(120px,1fr))] max-[480px]:grid-cols-2 max-[480px]:gap-3"},fn=["onClick"],vn={class:"relative w-full aspect-square rounded-xl overflow-hidden mb-2.5 bg-black/20"},hn=["src","alt"],mn={key:0,class:"clothes-checkmark absolute top-2 right-2 w-[32px] h-[32px] bg-[#79d9ff] rounded-full flex items-center justify-center text-black shadow-[0_4px_12px_rgba(121,217,255,0.6)]"},gn={class:"text-[14px] font-semibold text-white text-center m-0 whitespace-nowrap overflow-hidden text-ellipsis text-shadow-[0_2px_4px_rgba(0,0,0,0.3)] md:text-[12px]"},bn={key:1,class:"no-clothes-message flex flex-col items-center justify-center p-[60px_20px] text-white/60 text-center"},_n=j({__name:"SettingsCharacter",setup(n){const e=m([]),u=m(1),l=m(!1),a=m(null),s=re(),c=me(),d=Q(),_=async()=>{try{const $=await nn();return console.log("list:",$),$.map(C=>({id:parseInt(C.character_id),title:C.title,info:C.info||"æš‚æ— è§’è‰²æè¿°",avatar:C.avatar_path?`/api/v1/chat/character/character_file/${encodeURIComponent(C.avatar_path)}`:"../pictures/characters/default.png",clothes:C.clothes?C.clothes.map(y=>({title:y.title,avatar:y.avatar?`/api/v1/chat/character/clothes_file/${encodeURIComponent(`${y.avatar}\\æ­£å¸¸.png`)}`:"../pictures/characters/default.png"})):[]}))}catch($){return console.error("èŽ·å–è§’è‰²åˆ—è¡¨å¤±è´¥:",$),[]}},k=async()=>{try{const $=await _();e.value=$}catch($){console.error("åŠ è½½è§’è‰²å¤±è´¥:",$)}},A=async()=>{await s.initializeGame(c.client_id,"1")},M=$=>{a.value=$,l.value=!0},w=()=>{l.value=!1,a.value=null},i=async $=>{try{const C=await sn({user_id:u.value.toString(),character_id:$.toString()});A();const y=C?.character?.folder_name;if(y)if(await d.loadCharacterTips(y),d.tipsAvailable){const x=d.getSwitchTip("success");d.showSuccess({title:x.title,message:x.message})}else console.log(`è§’è‰² ${y} æ²¡æœ‰ tips.txtï¼Œä¸æ˜¾ç¤ºåˆ‡æ¢æˆåŠŸå¼¹çª—`)}catch(C){if(console.error("åˆ‡æ¢è§’è‰²å¤±è´¥:",C),d.tipsAvailable){const y=d.getSwitchTip("fail");d.showError({title:y.title,message:y.message})}}},r=async()=>{try{const $=await fetch("/api/v1/chat/character/refresh_characters",{method:"POST",headers:{"Content-Type":"application/json"}});if(!$.ok)throw new Error(`HTTP error! status: ${$.status}`);await $.json(),alert("åˆ·æ–°æˆåŠŸ"),await k()}catch($){alert("åˆ·æ–°å¤±è´¥"),console.error("åˆ·æ–°å¤±è´¥:",$)}},b=async $=>{s.avatar.clothes_name=$},I=async()=>{try{const $=await fetch("/api/v1/chat/character/open_web");if(!$.ok)throw new Error(`HTTP error! status: ${$.status}`);await $.json()}catch($){alert("å¯åŠ¨å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨åŽ»lingchatçš„discussionç½‘é¡µ"),console.error("æ‰“å¼€åˆ›æ„å·¥åŠå¤±è´¥:",$)}};function T($){return s.avatar.character_id===$}function V($){return s.avatar.clothes_name===$}return Z(()=>{k()}),U(()=>s.avatar.character_id,()=>{k()}),($,C)=>(v(),g(O,null,[p(o(ae),null,{default:h(()=>[p(o(P),{title:"è§’è‰²åˆ—è¡¨"},{default:h(()=>[p(an,null,{default:h(()=>[t("div",on,[(v(!0),g(O,null,Y(e.value,y=>(v(),W(Xa,{key:y.id,avatar:y.avatar,name:y.title,info:y.info,clothes:y.clothes||[],selectClothes:b,isClothesSelected:V},{actions:h(()=>[p(o(D),{type:"nav",class:N(["clothes-select-btn bottom-3.75 right-20 text-white border-none p-[6px_12px] rounded-[20px] cursor-pointer transition-all duration-200 ease-in font-medium hover:bg-[#4a5acf] hover:-translate-y-px hover:shadow-[0_2px_6px_rgba(94,114,228,0.3)]",{dim:!T(y.id)}]),onClick:()=>M(y)},{default:h(()=>[...C[1]||(C[1]=[B(S("é€‰æ‹©æœè£…"),-1)])]),_:1},8,["class","onClick"]),p(o(D),{type:"select",class:N(["character-select-btn bottom-3.75 right-3.75 text-white border-none p-[6px_12px] rounded-[20px] cursor-pointer transition-all duration-200 ease-in font-medium text-[13px] hover:bg-[#4a5acf] hover:-translate-y-px hover:shadow-[0_2px_6px_rgba(94,114,228,0.3)]",{selected:T(y.id)}]),onClick:x=>i(y.id)},{default:h(()=>[B(S(T(y.id)?"âˆš é€‰ä¸­":"é€‰æ‹©"),1)]),_:2},1032,["class","onClick"])]),_:2},1032,["avatar","name","info","clothes"]))),128))])]),_:1})]),_:1}),p(o(P),{title:"åˆ·æ–°äººç‰©åˆ—è¡¨",size:"small"},{default:h(()=>[p(o(D),{type:"big",onClick:r},{default:h(()=>[...C[2]||(C[2]=[B("ç‚¹æˆ‘åˆ·æ–°~",-1)])]),_:1})]),_:1}),p(o(P),{title:"åˆ›æ„å·¥åŠ",size:"small"},{default:h(()=>[p(o(D),{type:"big",onClick:I},{default:h(()=>[...C[3]||(C[3]=[B("è¿›å…¥åˆ›æ„å·¥åŠ",-1)])]),_:1})]),_:1})]),_:1}),p(Ae,{name:"modal"},{default:h(()=>[l.value?(v(),g("div",{key:0,class:"fixed top-0 left-0 w-full h-full flex items-center justify-center z-20 p-5 backdrop-blur-sm",onClick:w},[t("div",{class:"modal-container bg-[linear-gradient(135deg,rgba(255,255,255,0.15)_0%,rgba(255,255,255,0.05)_100%)] backdrop-blur-[30px] backdrop-saturate-180 rounded-3xl shadow-[0_20px_60px_rgba(0,0,0,0.4),inset_0_0_1px_rgba(255,255,255,0.3)] border border-white/20 max-w-200 w-full max-h-[90vh] overflow-hidden flex flex-col md:rounded-2xl",onClick:C[0]||(C[0]=pe(()=>{},["stop"]))},[t("div",ln,[t("div",rn,[a.value?(v(),g("img",{key:0,src:a.value.avatar,alt:a.value.title,class:"w-14 h-14 rounded-xl object-cover border-2 border-white/30 shadow-[0_4px_12px_rgba(0,0,0,0.2)] md:w-12 md:h-12"},null,8,un)):H("",!0),t("div",null,[t("h2",cn,S(a.value?.title),1),C[4]||(C[4]=t("p",{class:"text-[14px] text-white/70 m-0 mt-1"},"é€‰æ‹©æœè£…",-1))])]),t("button",{class:"w-10 h-10 rounded-full border-none bg-white/10 text-white cursor-pointer flex items-center justify-center transition-all duration-300 ease-in backdrop-blur-[10px] hover:bg-[rgba(255,86,86,0.8)] hover:rotate-90 hover:shadow-[0_4px_12px_rgba(255,86,86,0.4)] max-[480px]:w-9 max-[480px]:h-9",onClick:w},[...C[5]||(C[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t("line",{x1:"6",y1:"6",x2:"18",y2:"18"})],-1)])])]),t("div",dn,[a.value?.clothes&&a.value.clothes.length>0?(v(),g("div",pn,[(v(!0),g(O,null,Y(a.value.clothes,y=>(v(),g("div",{key:y.title,class:N(["clothes-item bg-white/8 border-2 border-white/10 rounded-2xl p-3 cursor-pointer transition-all duration-300 ease-in-out relative overflow-hidden hover:-translate-y-1 hover:scale-[1.02] hover:border-[#79d9ff]/50 hover:shadow-[0_8px_24px_rgba(0,0,0,0.3),0_0_20px_rgba(121,217,255,0.2)] md:p-2.5",{"clothes-item-selected":V(y.title)}]),onClick:x=>b(y.title)},[t("div",vn,[t("img",{src:y.avatar,alt:y.title,class:"w-full h-full object-contain transition-transform duration-300 ease-in hover:scale-110"},null,8,hn),V(y.title)?(v(),g("div",mn,[...C[6]||(C[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},[t("polyline",{points:"20 6 9 17 4 12"})],-1)])])):H("",!0)]),t("p",gn,S(y.title),1)],10,fn))),128))])):(v(),g("div",bn,[...C[7]||(C[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"}),t("line",{x1:"7",y1:"7",x2:"7.01",y2:"7"})],-1),t("p",null,"æš‚æ— å¯ç”¨æœè£…",-1)])]))])])])):H("",!0)]),_:1})],64))}}),yn=L(_n,[["__scopeId","data-v-28562008"]]),kn=async()=>{try{return await ee.get("/v1/chat/background/list",{})}catch(n){throw console.error("èŽ·å–æ¸¸æˆä¿¡æ¯é”™è¯¯:",n.message),n}},xn={class:"background-container"},wn={class:"background-list character-grid"},Cn={class:"background-image-container"},$n=["src","alt"],Sn=["data-title"],An={class:"effect-list"},Bn=j({__name:"SettingsBackground",setup(n){const e=m([]),u=m(""),l=m(null),a=Q();Z(async()=>{try{await c();const w=localStorage.getItem("selectedBackground");if(w)_(w);else if(e.value.length>0){const i=Math.floor(Math.random()*e.value.length);_(e.value[i]?.url||""),console.log("å·²é€‰éšæœºèƒŒæ™¯")}}catch(w){console.error("åŠ è½½èƒŒæ™¯å›¾ç‰‡å¤±è´¥",w)}});async function s(){try{return(await kn()).map(i=>({title:i.title?i.title:"è‰æ³¥é©¬",url:i.url?`/api/v1/chat/background/background_file/${encodeURIComponent(i.url)}`:"../pictures/background/default.png",time:i.time}))}catch(w){return console.error("èŽ·å–èƒŒæ™¯åˆ—è¡¨å¤±è´¥:",w),[]}}async function c(){e.value=await s()}function d(w){return u.value===w}function _(w){u.value=w,a.currentBackground=w,localStorage.setItem("selectedBackground",w)}function k(){l.value&&l.value.click()}async function A(w){const i=w.target,r=i.files?.[0];if(!r)return;const b=r.name,I=b.slice(b.lastIndexOf(".")).toLowerCase(),T=[".jpg",".png",".webp",".bmp",".svg",".tif",".gif"];if(!T.includes(I)){alert("è¯·ä¸Šä¼ æ”¯æŒçš„å›¾ç‰‡æ ¼å¼: "+T.join(", "));return}const V=new FormData;V.append("file",r),V.append("name",b);try{if(!(await fetch("/api/v1/chat/background/upload",{method:"POST",body:V})).ok)throw new Error("ä¸Šä¼ å¤±è´¥");await c(),i&&(i.value="")}catch($){console.error("ä¸Šä¼ å¤±è´¥",$),alert("ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•")}}function M(w){a.currentBackgroundEffect=w}return(w,i)=>(v(),W(o(ae),null,{default:h(()=>[p(o(P),{title:"èƒŒæ™¯é€‰æ‹©"},{default:h(()=>[t("div",xn,[t("div",wn,[(v(!0),g(O,null,Y(e.value,(r,b)=>(v(),g("div",{key:b,class:N(["background-card",{selected:d(r.url)}])},[t("div",Cn,[t("img",{src:r.url,alt:r.title,class:"background-image"},null,8,$n)]),t("div",{class:"background-title","data-title":r.title},[p(o(D),{class:N(["background-select-btn",{selected:d(r.url)}]),onClick:I=>_(r.url)},{default:h(()=>[B(S(d(r.url)?"å·²é€‰ä¸­":"é€‰æ‹©"),1)]),_:2},1032,["class","onClick"])],8,Sn)],2))),128))]),p(o(D),{type:"big",onClick:k},{default:h(()=>[...i[4]||(i[4]=[B("ä¸Šä¼ è‡ªå®šä¹‰èƒŒæ™¯",-1)])]),_:1}),t("input",{type:"file",ref_key:"uploadInput",ref:l,onChange:A,accept:".jpg,.png,.webp,.bmp,.svg,.tif,.gif",style:{display:"none"}},null,544)])]),_:1}),p(o(P),{title:"ç²’å­é€‰æ‹©",size:"large"},{default:h(()=>[t("div",An,[p(o(D),{type:"big",onClick:i[0]||(i[0]=r=>M("StarField"))},{default:h(()=>[...i[5]||(i[5]=[B("æ˜Ÿç©º",-1)])]),_:1}),p(o(D),{type:"big",onClick:i[1]||(i[1]=r=>M("Rain"))},{default:h(()=>[...i[6]||(i[6]=[B("é›¨æ°´",-1)])]),_:1}),p(o(D),{type:"big",onClick:i[2]||(i[2]=r=>M("Sakura"))},{default:h(()=>[...i[7]||(i[7]=[B("æ¨±èŠ±",-1)])]),_:1}),p(o(D),{type:"big",onClick:i[3]||(i[3]=r=>M("Snow"))},{default:h(()=>[...i[8]||(i[8]=[B("é›ªæ™¯",-1)])]),_:1})])]),_:1})]),_:1}))}}),In=L(Bn,[["__scopeId","data-v-f2e52d1f"]]),Mn={name:"SettingsUpdate",components:{MenuPage:ae,MenuItem:P,Button:D},data(){return{apiBaseUrl:"/api/v1/update",currentVersion:"æœªçŸ¥",updateAvailable:!1,updateStatus:"idle",updateInfo:null,updateChain:[],updateChainInfo:null,errorMessage:"",isChecking:!1,isDownloading:!1,isRollingBack:!1,progress:0,progressMessage:"",showProgress:!1,config:{auto_backup:!0},backendConnected:!1,connectionRetries:0,maxRetries:5,showRollbackDialog:!1,showBackupDialog:!1,statusPolling:null}},mounted(){this.checkBackendConnection()},beforeUnmount(){this.stopStatusPolling()},computed:{isCheckingUpdates(){return this.updateStatus==="checking"},isDownloadingUpdates(){return this.updateStatus==="downloading"},isApplyingUpdates(){return this.updateStatus==="applying"},isRollingBackUpdates(){return this.updateStatus==="rolling_back"},displayVersion(){return this.updateInfo&&(this.updateInfo.target_version||this.updateInfo.version)||"æœªçŸ¥"}},methods:{async checkBackendConnection(){try{const n=await ne.get(`${this.apiBaseUrl}/health`,{timeout:5e3});n.data&&n.data.status==="ok"&&(this.backendConnected=!0,this.connectionRetries=0,this.errorMessage="",this.loadAppInfo(),this.loadConfig(),this.startStatusPolling(),console.log("æˆåŠŸè¿žæŽ¥åˆ°æ›´æ–°æœåŠ¡"))}catch(n){console.error("æ— æ³•è¿žæŽ¥åˆ°åŽç«¯æœåŠ¡:",n),this.backendConnected=!1,this.connectionRetries<this.maxRetries?(this.connectionRetries++,console.log(`é‡è¯•è¿žæŽ¥ (${this.connectionRetries}/${this.maxRetries})...`),setTimeout(()=>this.checkBackendConnection(),2e3)):(this.errorMessage=`æ— æ³•è¿žæŽ¥åˆ°æ›´æ–°æœåŠ¡ã€‚è¯·ç¡®ä¿ä¸»åº”ç”¨æœåŠ¡æ­£åœ¨è¿è¡Œã€‚é”™è¯¯: ${n.message}`,this.stopStatusPolling())}},async loadAppInfo(){if(this.backendConnected)try{const n=await ne.get(`${this.apiBaseUrl}/info`,{timeout:5e3});n.data&&(this.currentVersion=n.data.current_version||"æœªçŸ¥",this.updateAvailable=n.data.update_available||!1,this.updateChainInfo=n.data.update_chain_info||null)}catch(n){console.error("èŽ·å–åº”ç”¨ä¿¡æ¯å¤±è´¥:",n),this.handleApiError(n,"èŽ·å–åº”ç”¨ä¿¡æ¯")}},async loadConfig(){if(this.backendConnected)try{const n=await ne.get(`${this.apiBaseUrl}/config`,{timeout:5e3});n.data&&(this.config.auto_backup=n.data.auto_backup||!0)}catch(n){console.error("èŽ·å–é…ç½®å¤±è´¥:",n),this.handleApiError(n,"èŽ·å–é…ç½®")}},async updateConfig(){if(this.backendConnected)try{await ne.post(`${this.apiBaseUrl}/config`,this.config,{timeout:5e3})}catch(n){console.error("æ›´æ–°é…ç½®å¤±è´¥:",n),this.handleApiError(n,"æ›´æ–°é…ç½®")}},startStatusPolling(){this.stopStatusPolling(),this.statusPolling=setInterval(async()=>{await this.getUpdateStatus()},1e3)},stopStatusPolling(){this.statusPolling&&(clearInterval(this.statusPolling),this.statusPolling=null)},async getUpdateStatus(){if(this.backendConnected)try{const n=await ne.get(`${this.apiBaseUrl}/status`,{timeout:5e3});if(n.data){const e=n.data;this.updateStatus=e.status||"idle",this.progress=e.progress||0,this.progressMessage=e.message||"",this.isChecking=this.updateStatus==="checking",this.isDownloading=["downloading","applying"].includes(this.updateStatus),this.isRollingBack=this.updateStatus==="rolling_back",e.error?this.errorMessage=e.error:this.updateStatus!=="error"&&(this.errorMessage=""),e.update_info&&(this.updateInfo=e.update_info,this.updateAvailable=!0,e.update_info.update_chain&&e.update_info.update_chain.length>0?this.updateChain=e.update_info.update_chain:this.updateChain=[]),this.showProgress=["checking","downloading","applying","rolling_back"].includes(this.updateStatus),this.updateStatus==="completed"&&setTimeout(()=>{this.loadAppInfo(),this.updateAvailable=!1,this.updateInfo=null,this.updateChain=[]},1e3)}}catch(n){console.error("èŽ·å–æ›´æ–°çŠ¶æ€å¤±è´¥:",n),this.handleApiError(n,"èŽ·å–æ›´æ–°çŠ¶æ€")}},handleApiError(n,e){n.code==="NETWORK_ERROR"||n.message.includes("Network Error")?(this.backendConnected=!1,this.errorMessage="ç½‘ç»œé”™è¯¯: æ— æ³•è¿žæŽ¥åˆ°æ›´æ–°æœåŠ¡ã€‚è¯·ç¡®ä¿ä¸»åº”ç”¨æœåŠ¡æ­£åœ¨è¿è¡Œã€‚",this.stopStatusPolling()):n.response?this.errorMessage=`${e}å¤±è´¥: æœåŠ¡å™¨è¿”å›žé”™è¯¯ ${n.response.status}`:n.request?(this.backendConnected=!1,this.errorMessage=`${e}å¤±è´¥: æ— æ³•è¿žæŽ¥åˆ°æœåŠ¡å™¨`,this.stopStatusPolling()):this.errorMessage=`${e}å¤±è´¥: ${n.message}`},async checkForUpdates(){this.errorMessage="";try{const n=await ne.post(`${this.apiBaseUrl}/check`,{},{timeout:1e4});n.data&&n.data.success?this.progressMessage="æ­£åœ¨æ£€æŸ¥æ›´æ–°...":this.errorMessage=n.data.error||"æ£€æŸ¥æ›´æ–°å¤±è´¥"}catch(n){console.error("æ£€æŸ¥æ›´æ–°å¤±è´¥:",n),this.handleApiError(n,"æ£€æŸ¥æ›´æ–°")}},async downloadAndApplyUpdate(){this.errorMessage="",this.updateChain&&this.updateChain.length>1?this.showBackupDialog=!0:await this.startUpdate(this.config.auto_backup)},async startUpdate(n){try{const e=await ne.post(`${this.apiBaseUrl}/apply`,{backup:n},{timeout:3e4});e.data&&e.data.success?this.progressMessage="å¼€å§‹ä¸‹è½½æ›´æ–°...":this.errorMessage=e.data.error||"å¼€å§‹æ›´æ–°å¤±è´¥"}catch(e){console.error("å¼€å§‹æ›´æ–°å¤±è´¥:",e),this.handleApiError(e,"å¼€å§‹æ›´æ–°")}},confirmUpdateWithBackup(n){this.showBackupDialog=!1,this.startUpdate(n)},cancelUpdate(){this.showBackupDialog=!1},rollbackUpdate(){this.showRollbackDialog=!0},async confirmRollback(){this.showRollbackDialog=!1,this.errorMessage="";try{const n=await ne.post(`${this.apiBaseUrl}/rollback`,{},{timeout:3e4});n.data&&n.data.success?this.progressMessage="æ­£åœ¨å›žæ»š...":this.errorMessage=n.data.error||"å¼€å§‹å›žæ»šå¤±è´¥"}catch(n){console.error("å¼€å§‹å›žæ»šå¤±è´¥:",n),this.handleApiError(n,"å¼€å§‹å›žæ»š")}},cancelRollback(){this.showRollbackDialog=!1}}},Tn={key:0,class:"connection-status error"},En={key:1,class:"connection-status success"},Rn={class:"current-version"},Vn={key:0,class:"update-chain-info"},zn={key:1,class:"error-message"},Dn={class:"action-buttons"},Un={class:"update-info"},Pn={key:0},jn={key:1},Fn={class:"progress-container"},On={class:"progress-bar"},Ln={class:"progress-text"},Nn={class:"config-item"},Hn={key:2,class:"dialog-overlay"},Gn={class:"dialog"},Wn={class:"dialog-actions"},qn={key:3,class:"dialog-overlay"},Kn={class:"dialog"},Jn={class:"dialog-actions"};function Qn(n,e,u,l,a,s){const c=ve("Button"),d=ve("MenuItem"),_=ve("MenuPage");return v(),W(_,null,{default:h(()=>[p(d,{title:"ðŸ”— æ›´æ–°æœåŠ¡è¿žæŽ¥çŠ¶æ€",size:"small"},{default:h(()=>[a.backendConnected?(v(),g("div",En,[...e[7]||(e[7]=[t("p",null,"âœ… å·²è¿žæŽ¥åˆ°æ›´æ–°æœåŠ¡",-1)])])):(v(),g("div",Tn,[e[5]||(e[5]=t("p",null,"âš ï¸ æœªè¿žæŽ¥åˆ°æ›´æ–°æœåŠ¡",-1)),e[6]||(e[6]=t("p",null,"è¯·ç¡®ä¿ä¸»åº”ç”¨æœåŠ¡æ­£åœ¨è¿è¡Œï¼ˆä¸€èˆ¬ä¸å¯èƒ½åœ¨éžè¿è¡ŒçŠ¶æ€ï¼‰",-1)),p(c,{type:"big",onClick:s.checkBackendConnection},{default:h(()=>[...e[4]||(e[4]=[B("é‡è¯•è¿žæŽ¥",-1)])]),_:1},8,["onClick"])]))]),_:1}),p(d,{title:"ðŸ“‹ å½“å‰ç‰ˆæœ¬ä¿¡æ¯",size:"small"},{default:h(()=>[t("div",Rn,[t("p",null,[e[8]||(e[8]=t("strong",null,"å½“å‰ç‰ˆæœ¬:",-1)),B(" "+S(a.currentVersion),1)]),t("p",null,[e[9]||(e[9]=t("strong",null,"æ›´æ–°çŠ¶æ€:",-1)),B(" "+S(a.updateStatus),1)]),a.updateChainInfo&&a.updateChainInfo.update_count>1?(v(),g("p",Vn," å‘çŽ° "+S(a.updateChainInfo.update_count)+" ä¸ªå¾…æ›´æ–°ç‰ˆæœ¬: "+S(a.updateChainInfo.current_version)+" â†’ "+S(a.updateChainInfo.target_version),1)):H("",!0),a.errorMessage?(v(),g("p",zn,S(a.errorMessage),1)):H("",!0)])]),_:1}),p(d,{title:"ðŸ”„ æ›´æ–°æ“ä½œ",size:"large"},{default:h(()=>[t("div",Dn,[p(c,{type:"big",onClick:s.checkForUpdates,disabled:!a.backendConnected||a.isChecking||a.isDownloading||a.isRollingBack,class:"left-button"},{default:h(()=>[B(S(a.isChecking?"â³ æ£€æŸ¥ä¸­...":"ðŸ” æ£€æŸ¥æ›´æ–°"),1)]),_:1},8,["onClick","disabled"]),p(c,{type:"big",onClick:s.downloadAndApplyUpdate,disabled:!a.backendConnected||!a.updateAvailable||a.isChecking||a.isDownloading||a.isRollingBack,class:"left-button"},{default:h(()=>[B(S(a.isDownloading?"â³ ä¸‹è½½ä¸­...":"ðŸ“¥ ä¸‹è½½å¹¶åº”ç”¨æ›´æ–°"),1)]),_:1},8,["onClick","disabled"]),p(c,{type:"big",onClick:s.rollbackUpdate,disabled:!a.backendConnected||a.isChecking||a.isDownloading||a.isRollingBack,class:"left-button danger"},{default:h(()=>[B(S(a.isRollingBack?"â³ å›žæ»šä¸­...":"â†©ï¸ å›žæ»šåˆ°ä¸Šæ¬¡å¤‡ä»½"),1)]),_:1},8,["onClick","disabled"])])]),_:1}),a.updateInfo?(v(),W(d,{key:0,title:"ðŸ†• å‘çŽ°æ–°ç‰ˆæœ¬",size:"small"},{default:h(()=>[t("div",Un,[a.updateChain&&a.updateChain.length>0?(v(),g("div",Pn,[t("p",null,[t("strong",null,"å‘çŽ° "+S(a.updateChain.length)+" ä¸ªå¾…æ›´æ–°ç‰ˆæœ¬:",1)]),(v(!0),g(O,null,Y(a.updateChain,(k,A)=>(v(),g("div",{key:A,class:"update-chain-item"},[t("p",null,[t("strong",null,"ç‰ˆæœ¬ "+S(k.version||"æœªçŸ¥"),1),B(" - "+S(k.changelog||"æ— æ›´æ–°è¯´æ˜Ž"),1)])]))),128))])):(v(),g("div",jn,[t("p",null,[e[10]||(e[10]=t("strong",null,"ç‰ˆæœ¬:",-1)),B(" "+S(s.displayVersion),1)]),t("p",null,[e[11]||(e[11]=t("strong",null,"æ›´æ–°å†…å®¹:",-1)),B(" "+S(a.updateInfo.changelog||"æ— "),1)])]))])]),_:1})):H("",!0),a.showProgress?(v(),W(d,{key:1,title:"ðŸ“Š æ›´æ–°è¿›åº¦",size:"small"},{default:h(()=>[t("div",Fn,[t("div",On,[t("div",{class:"progress-fill",style:te({width:a.progress+"%"})},null,4)]),t("p",Ln,S(a.progressMessage),1)])]),_:1})):H("",!0),p(d,{title:"âš™ æ›´æ–°é…ç½®"},{default:h(()=>[t("div",Nn,[t("label",null,[G(t("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=k=>a.config.auto_backup=k),onChange:e[1]||(e[1]=(...k)=>s.updateConfig&&s.updateConfig(...k))},null,544),[[ye,a.config.auto_backup]]),e[12]||(e[12]=B(" è‡ªåŠ¨åˆ›å»ºå¤‡ä»½ ",-1))]),e[13]||(e[13]=t("span",{class:"config-help"},"åº”ç”¨æ›´æ–°å‰è‡ªåŠ¨åˆ›å»ºå®Œæ•´å¤‡ä»½",-1))])]),_:1}),a.showRollbackDialog?(v(),g("div",Hn,[t("div",Gn,[e[16]||(e[16]=t("h3",null,"ç¡®è®¤å›žæ»š",-1)),e[17]||(e[17]=t("p",null,"ç¡®è®¤å›žæ»šåˆ°ä¸Šæ¬¡å¤‡ä»½å—ï¼Ÿ",-1)),t("div",Wn,[p(c,{type:"big",onClick:s.confirmRollback,class:"danger"},{default:h(()=>[...e[14]||(e[14]=[B("ç¡®è®¤å›žæ»š",-1)])]),_:1},8,["onClick"]),p(c,{type:"big",onClick:s.cancelRollback,class:"left-button"},{default:h(()=>[...e[15]||(e[15]=[B("å–æ¶ˆ",-1)])]),_:1},8,["onClick"])])])])):H("",!0),a.showBackupDialog?(v(),g("div",qn,[t("div",Kn,[e[21]||(e[21]=t("h3",null,"åˆ›å»ºå¤‡ä»½",-1)),e[22]||(e[22]=t("p",null,"æ˜¯å¦åœ¨åº”ç”¨å‰åˆ›å»ºå…¨é‡å¤‡ä»½ï¼Ÿ",-1)),t("div",Jn,[p(c,{type:"big",onClick:e[2]||(e[2]=k=>s.confirmUpdateWithBackup(!0)),class:"left-button"},{default:h(()=>[...e[18]||(e[18]=[B("æ˜¯",-1)])]),_:1}),p(c,{type:"big",onClick:e[3]||(e[3]=k=>s.confirmUpdateWithBackup(!1)),class:"left-button"},{default:h(()=>[...e[19]||(e[19]=[B("å¦",-1)])]),_:1}),p(c,{type:"big",onClick:s.cancelUpdate,class:"left-button"},{default:h(()=>[...e[20]||(e[20]=[B("å–æ¶ˆ",-1)])]),_:1},8,["onClick"])])])])):H("",!0)]),_:1})}const Yn=L(Mn,[["render",Qn],["__scopeId","data-v-ee957529"]]),Xn={class:"w-full h-full flex items-center justify-between relative px-5 py-2"},Zn=j({__name:"SettingsNav",emits:["remove-more-menu-from-a"],setup(n,{expose:e,emit:u}){const l=u,a=Q(),s=m(null),c=m(null),d=m(null),_=m(null),k=m(null),A=m(null),M=m(null),w=m(null),i=m(null),r=m(null),b=m(null),I=m("textBtn"),T=z=>{const f={characterBtn:d,textBtn:_,backgroundBtn:k,soundBtn:A,historyBtn:M,saveBtn:w,advanceBtn:i,scheduleBtn:r,updateBtn:b}[z];f?.value?.$el&&V(f.value.$el)},V=z=>{!s.value||!z||(s.value.style.left=`${z.offsetLeft}px`,s.value.style.width=`${z.offsetWidth}px`)},$=(z,f)=>{I.value=f,a.setSettingsTab(z),s.value&&(s.value.style.transition="left 0.3s cubic-bezier(0.18, 0.89, 0.32, 1), width 0.3s cubic-bezier(0.18, 0.89, 0.32, 1)",T(f),setTimeout(()=>{s.value&&(s.value.style.transition="unset")},400))},C=()=>{if(!c.value)return;new ResizeObserver(f=>{I.value&&T(I.value)}).observe(c.value)},y=()=>{const z=a.currentSettingsTab;let f=null;switch(z){case"character":f=d.value;break;case"text":f=_.value;break;case"background":f=k.value;break;case"sound":f=A.value;break;case"history":f=M.value;break;case"save":f=w.value;break;case"advance":f=i.value;break;case"schedule":f=r.value;break;case"update":f=b.value;break}f?.$el&&V(f.$el)};Z(()=>{y(),C()}),U(()=>a.currentSettingsTab,()=>{y()});const x=()=>{a.toggleSettings(!1),I.value="textBtn"},E=()=>{const z=i.value?.$el;z&&z.classList.add("moreMenu")},q=()=>{const z=i.value?.$el;z&&z.classList.remove("moreMenu"),l("remove-more-menu-from-a")};return e({addMoreMenu:E}),U(()=>{},()=>{},{immediate:!0}),(z,f)=>(v(),g("div",Xn,[f[18]||(f[18]=t("img",{src:Ie,alt:"Logo",class:"w-20 ml-5 hidden xl:block"},null,-1)),t("nav",{ref_key:"navContainer",ref:c,class:"relative w-full flex felx-row items-center justify-around h-full ease-in-out duration-100 xl:justify-center overflow-x-auto overflow-y-hidden"},[t("div",{ref_key:"indicator",ref:s,class:"absolute bottom-0 left-0 w-0 h-1 bg-brand rounded z-10 shadow-[0_0_10px_rgba(121,217,255,0.4)]"},null,512),p(o(D),{ref_key:"characterBtn",ref:d,type:"nav",icon:"character",onClick:f[0]||(f[0]=()=>$("character","characterBtn")),class:N({active:o(a).currentSettingsTab==="character"})},{default:h(()=>[...f[9]||(f[9]=[t("p",{class:"hidden xl:block"},"è§’è‰²",-1)])]),_:1},8,["class"]),p(o(D),{ref_key:"textBtn",ref:_,type:"nav",icon:"text",onClick:f[1]||(f[1]=()=>$("text","textBtn")),class:N({active:o(a).currentSettingsTab==="text"})},{default:h(()=>[...f[10]||(f[10]=[t("p",{class:"hidden xl:block"},"é€šç”¨",-1)])]),_:1},8,["class"]),p(o(D),{ref_key:"backgroundBtn",ref:k,type:"nav",icon:"background",onClick:f[2]||(f[2]=()=>$("background","backgroundBtn")),class:N({active:o(a).currentSettingsTab==="background"})},{default:h(()=>[...f[11]||(f[11]=[t("p",{class:"hidden xl:block"},"èƒŒæ™¯",-1)])]),_:1},8,["class"]),p(o(D),{ref_key:"soundBtn",ref:A,type:"nav",icon:"sound",onClick:f[3]||(f[3]=()=>$("sound","soundBtn")),class:N({active:o(a).currentSettingsTab==="sound"})},{default:h(()=>[...f[12]||(f[12]=[t("p",{class:"hidden xl:block"},"å£°éŸ³",-1)])]),_:1},8,["class"]),p(o(D),{ref_key:"historyBtn",ref:M,type:"nav",icon:"history",onClick:f[4]||(f[4]=()=>$("history","historyBtn")),class:N({active:o(a).currentSettingsTab==="history"})},{default:h(()=>[...f[13]||(f[13]=[t("p",{class:"hidden xl:block"},"å¯¹è¯åŽ†å²",-1)])]),_:1},8,["class"]),p(o(D),{ref_key:"saveBtn",ref:w,type:"nav",icon:"save",onClick:f[5]||(f[5]=()=>$("save","saveBtn")),class:N({active:o(a).currentSettingsTab==="save"})},{default:h(()=>[...f[14]||(f[14]=[t("p",{class:"hidden xl:block"},"å­˜æ¡£",-1)])]),_:1},8,["class"]),p(o(D),{ref_key:"scheduleBtn",ref:r,type:"nav",icon:"schedule",onClick:f[6]||(f[6]=()=>$("schedule","scheduleBtn")),class:N({active:o(a).currentSettingsTab==="schedule"})},{default:h(()=>[...f[15]||(f[15]=[t("p",{class:"hidden xl:block"},"æ—¥ç¨‹",-1)])]),_:1},8,["class"]),p(o(D),{ref_key:"advanceBtn",ref:i,type:"nav",icon:"advance",onClick:f[7]||(f[7]=()=>{$("advance","advanceBtn"),q()}),class:N({active:o(a).currentSettingsTab==="advance"})},{default:h(()=>[...f[16]||(f[16]=[t("p",{class:"hidden xl:block"},"é«˜çº§è®¾ç½®",-1)])]),_:1},8,["class"]),p(o(D),{ref_key:"updateBtn",ref:b,type:"nav",icon:"update",onClick:f[8]||(f[8]=()=>$("update","updateBtn")),class:N({active:o(a).currentSettingsTab==="update"})},{default:h(()=>[...f[17]||(f[17]=[t("p",{class:"hidden xl:block"},"æ£€æŸ¥æ›´æ–°",-1)])]),_:1},8,["class"])],512),p(xe,{icon:"close",class:"bg-transparent border-none p-1.5 rounded-full cursor-pointer flex items-center justify-center text-white transition-all duration-300 ease-in-out hover:text-accent hover:bg-white/10 hover:rotate-90",size:40,onClick:x})]))}}),es={class:"settings-panel"},ts={class:"h-[7vh] w-full"},as={class:"w-full h-[93vh] overflow-auto"},ls=j({__name:"SettingsPanel",setup(n){const e=Q(),u=m(null),l=m(null),a=m(!1),s=m(0);U(()=>e.showSettings,_=>{_?(a.value=!0,setTimeout(()=>{s.value=1},10)):(s.value=0,setTimeout(()=>{a.value=!1},100))},{immediate:!0});const c=()=>{l.value?.addMoreMenu()},d=()=>{u.value?.addMoreMenu()};return(_,k)=>(v(),g(O,null,[a.value?(v(),g("div",{key:0,class:"blur-overlay",style:te({opacity:s.value})},null,4)):H("",!0),G(t("div",es,[t("div",ts,[p(Zn,{ref_key:"settingsNavRef",ref:u,onRemoveMoreMenuFromA:c},null,512)]),t("div",as,[G(p(o(jt),null,null,512),[[X,o(e).currentSettingsTab==="save"]]),G(p(o(Ot),null,null,512),[[X,o(e).currentSettingsTab==="text"]]),G(p(o(ea),null,null,512),[[X,o(e).currentSettingsTab==="sound"]]),G(p(o(wa),{ref_key:"settingsAdvanceRef",ref:l,onRemoveMoreMenuFromB:d},null,512),[[X,o(e).currentSettingsTab==="advance"]]),G(p(o(Na),null,null,512),[[X,o(e).currentSettingsTab==="history"]]),G(p(o(Ha),null,null,512),[[X,o(e).currentSettingsTab==="schedule"]]),G(p(o(yn),null,null,512),[[X,o(e).currentSettingsTab==="character"]]),G(p(o(In),null,null,512),[[X,o(e).currentSettingsTab==="background"]]),G(p(o(Yn),null,null,512),[[X,o(e).currentSettingsTab==="update"]])])],512),[[X,o(e).showSettings]])],64))}});export{os as _,ls as a};
